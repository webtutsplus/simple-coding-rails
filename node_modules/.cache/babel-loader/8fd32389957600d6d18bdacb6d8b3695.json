{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nimport { h, Component } from 'preact';\nimport PropTypes from 'prop-types';\nimport he from 'he';\nimport { getContentOfToken } from '../utilities';\nimport Navigation from './Navigation';\n\nvar FollowUsers = /*#__PURE__*/function (_Component) {\n  _inherits(FollowUsers, _Component);\n\n  var _super = _createSuper(FollowUsers);\n\n  function FollowUsers(props) {\n    var _this;\n\n    _classCallCheck(this, FollowUsers);\n\n    _this = _super.call(this, props);\n    _this.handleClick = _this.handleClick.bind(_assertThisInitialized(_this));\n    _this.handleComplete = _this.handleComplete.bind(_assertThisInitialized(_this));\n    _this.state = {\n      users: [],\n      selectedUsers: []\n    };\n    return _this;\n  }\n\n  _createClass(FollowUsers, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      fetch('/users?state=follow_suggestions', {\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin'\n      }).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        _this2.setState({\n          users: data\n        });\n      });\n      var csrfToken = getContentOfToken('csrf-token');\n      fetch('/onboarding_update', {\n        method: 'PATCH',\n        headers: {\n          'X-CSRF-Token': csrfToken,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          user: {\n            last_onboarding_page: 'v2: follow users page'\n          }\n        }),\n        credentials: 'same-origin'\n      });\n    }\n  }, {\n    key: \"handleComplete\",\n    value: function handleComplete() {\n      var csrfToken = getContentOfToken('csrf-token');\n      var selectedUsers = this.state.selectedUsers;\n      var next = this.props.next;\n      fetch('/api/follows', {\n        method: 'POST',\n        headers: {\n          'X-CSRF-Token': csrfToken,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          users: selectedUsers\n        }),\n        credentials: 'same-origin'\n      });\n      next();\n    }\n  }, {\n    key: \"handleSelectAll\",\n    value: function handleSelectAll() {\n      var _this$state = this.state,\n          selectedUsers = _this$state.selectedUsers,\n          users = _this$state.users;\n\n      if (selectedUsers.length === users.length) {\n        this.setState({\n          selectedUsers: []\n        });\n      } else {\n        this.setState({\n          selectedUsers: users\n        });\n      }\n    }\n  }, {\n    key: \"handleClick\",\n    value: function handleClick(user) {\n      var selectedUsers = this.state.selectedUsers;\n\n      if (!selectedUsers.includes(user)) {\n        this.setState(function (prevState) {\n          return {\n            selectedUsers: [].concat(_toConsumableArray(prevState.selectedUsers), [user])\n          };\n        });\n      } else {\n        selectedUsers = _toConsumableArray(selectedUsers);\n        var indexToRemove = selectedUsers.indexOf(user);\n        selectedUsers.splice(indexToRemove, 1);\n        this.setState({\n          selectedUsers: selectedUsers\n        });\n      }\n    }\n  }, {\n    key: \"renderFollowCount\",\n    value: function renderFollowCount() {\n      var _this$state2 = this.state,\n          users = _this$state2.users,\n          selectedUsers = _this$state2.selectedUsers;\n      var followingStatus;\n\n      if (selectedUsers.length === 0) {\n        followingStatus = \"You're not following anyone\";\n      } else if (selectedUsers.length === 1) {\n        followingStatus = \"You're following 1 person\";\n      } else if (selectedUsers.length === users.length) {\n        followingStatus = \"You're following \".concat(selectedUsers.length, \" people (everyone) -\");\n      } else {\n        followingStatus = \"You're following \".concat(selectedUsers.length, \" people -\");\n      }\n\n      var klassName = selectedUsers.length > 0 ? 'fw-bold color-base-60 inline-block fs-base' : 'color-base-60 inline-block fs-base';\n      return h(\"p\", {\n        className: klassName\n      }, followingStatus);\n    }\n  }, {\n    key: \"renderFollowToggle\",\n    value: function renderFollowToggle() {\n      var _this3 = this;\n\n      var _this$state3 = this.state,\n          users = _this$state3.users,\n          selectedUsers = _this$state3.selectedUsers;\n      var followText = '';\n\n      if (selectedUsers.length !== users.length) {\n        if (users.length === 1) {\n          followText = \"Select \".concat(users.length, \" person\");\n        } else {\n          followText = \"Select all \".concat(users.length, \" people\");\n        }\n      } else {\n        followText = 'Deselect all';\n      }\n\n      return h(\"button\", {\n        type: \"button\",\n        \"class\": \"crayons-btn crayons-btn--ghost-brand -ml-2\",\n        onClick: function onClick() {\n          return _this3.handleSelectAll();\n        }\n      }, followText);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$state4 = this.state,\n          users = _this$state4.users,\n          selectedUsers = _this$state4.selectedUsers;\n      var _this$props = this.props,\n          prev = _this$props.prev,\n          slidesCount = _this$props.slidesCount,\n          currentSlideIndex = _this$props.currentSlideIndex;\n      var canSkip = selectedUsers.length === 0;\n      return h(\"div\", {\n        \"data-testid\": \"onboarding-follow-users\",\n        className: \"onboarding-main crayons-modal\"\n      }, h(\"div\", {\n        className: \"crayons-modal__box overflow-auto\",\n        role: \"dialog\",\n        \"aria-labelledby\": \"title\",\n        \"aria-describedby\": \"subtitle\"\n      }, h(Navigation, {\n        prev: prev,\n        next: this.handleComplete,\n        canSkip: canSkip,\n        slidesCount: slidesCount,\n        currentSlideIndex: currentSlideIndex\n      }), h(\"div\", {\n        className: \"onboarding-content toggle-bottom\"\n      }, h(\"header\", {\n        className: \"onboarding-content-header\"\n      }, h(\"h1\", {\n        id: \"title\",\n        className: \"title\"\n      }, \"Suggested people to follow\"), h(\"h2\", {\n        id: \"subtitle\",\n        className: \"subtitle\"\n      }, \"Let's review a few things first\"), h(\"div\", {\n        className: \"onboarding-selection-status\"\n      }, this.renderFollowCount(), this.renderFollowToggle())), h(\"div\", {\n        \"data-testid\": \"onboarding-users\"\n      }, users.map(function (user) {\n        return h(\"button\", {\n          \"data-testid\": \"onboarding-user-button\",\n          type: \"button\",\n          onClick: function onClick() {\n            return _this4.handleClick(user);\n          },\n          onKeyDown: function onKeyDown() {\n            return _this4.handleKeyDown(user);\n          },\n          className: selectedUsers.includes(user) ? 'user content-row selected' : 'user content-row unselected'\n        }, h(\"figure\", {\n          className: \"user-avatar-container\"\n        }, h(\"img\", {\n          className: \"user-avatar\",\n          src: user.profile_image_url,\n          alt: \"profile\"\n        })), h(\"div\", {\n          className: \"user-info\"\n        }, h(\"h4\", {\n          className: \"user-name\"\n        }, user.name), h(\"p\", {\n          className: \"user-summary\"\n        }, he.unescape(user.summary || ''))), h(\"button\", {\n          \"data-testid\": \"onboarding-user-following-status\",\n          type: \"button\",\n          className: \"user-following-status\"\n        }, selectedUsers.includes(user) ? 'Following' : 'Follow'));\n      })))));\n    }\n  }]);\n\n  return FollowUsers;\n}(Component);\n\nFollowUsers.propTypes = {\n  prev: PropTypes.func.isRequired,\n  next: PropTypes.string.isRequired,\n  slidesCount: PropTypes.number.isRequired,\n  currentSlideIndex: PropTypes.func.isRequired\n};\nexport default FollowUsers;","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/onboarding/components/FollowUsers.jsx"],"names":["h","Component","PropTypes","he","getContentOfToken","Navigation","FollowUsers","props","handleClick","bind","handleComplete","state","users","selectedUsers","fetch","headers","Accept","credentials","then","response","json","data","setState","csrfToken","method","body","JSON","stringify","user","last_onboarding_page","next","length","includes","prevState","indexToRemove","indexOf","splice","followingStatus","klassName","followText","handleSelectAll","prev","slidesCount","currentSlideIndex","canSkip","renderFollowCount","renderFollowToggle","map","handleKeyDown","profile_image_url","name","unescape","summary","propTypes","func","isRequired","string","number"],"mappings":"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","sourcesContent":["import { h, Component } from 'preact';\nimport PropTypes from 'prop-types';\nimport he from 'he';\n\nimport { getContentOfToken } from '../utilities';\nimport Navigation from './Navigation';\n\nclass FollowUsers extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n    this.handleComplete = this.handleComplete.bind(this);\n\n    this.state = {\n      users: [],\n      selectedUsers: [],\n    };\n  }\n\n  componentDidMount() {\n    fetch('/users?state=follow_suggestions', {\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      credentials: 'same-origin',\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        this.setState({ users: data });\n      });\n\n    const csrfToken = getContentOfToken('csrf-token');\n    fetch('/onboarding_update', {\n      method: 'PATCH',\n      headers: {\n        'X-CSRF-Token': csrfToken,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        user: { last_onboarding_page: 'v2: follow users page' },\n      }),\n      credentials: 'same-origin',\n    });\n  }\n\n  handleComplete() {\n    const csrfToken = getContentOfToken('csrf-token');\n    const { selectedUsers } = this.state;\n    const { next } = this.props;\n\n    fetch('/api/follows', {\n      method: 'POST',\n      headers: {\n        'X-CSRF-Token': csrfToken,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ users: selectedUsers }),\n      credentials: 'same-origin',\n    });\n\n    next();\n  }\n\n  handleSelectAll() {\n    const { selectedUsers, users } = this.state;\n    if (selectedUsers.length === users.length) {\n      this.setState({\n        selectedUsers: [],\n      });\n    } else {\n      this.setState({\n        selectedUsers: users,\n      });\n    }\n  }\n\n  handleClick(user) {\n    let { selectedUsers } = this.state;\n\n    if (!selectedUsers.includes(user)) {\n      this.setState((prevState) => ({\n        selectedUsers: [...prevState.selectedUsers, user],\n      }));\n    } else {\n      selectedUsers = [...selectedUsers];\n      const indexToRemove = selectedUsers.indexOf(user);\n      selectedUsers.splice(indexToRemove, 1);\n      this.setState({\n        selectedUsers,\n      });\n    }\n  }\n\n  renderFollowCount() {\n    const { users, selectedUsers } = this.state;\n    let followingStatus;\n    if (selectedUsers.length === 0) {\n      followingStatus = \"You're not following anyone\";\n    } else if (selectedUsers.length === 1) {\n      followingStatus = \"You're following 1 person\";\n    } else if (selectedUsers.length === users.length) {\n      followingStatus = `You're following ${selectedUsers.length} people (everyone) -`;\n    } else {\n      followingStatus = `You're following ${selectedUsers.length} people -`;\n    }\n    const klassName =\n      selectedUsers.length > 0\n        ? 'fw-bold color-base-60 inline-block fs-base'\n        : 'color-base-60 inline-block fs-base';\n\n    return <p className={klassName}>{followingStatus}</p>;\n  }\n\n  renderFollowToggle() {\n    const { users, selectedUsers } = this.state;\n    let followText = '';\n\n    if (selectedUsers.length !== users.length) {\n      if (users.length === 1) {\n        followText = `Select ${users.length} person`;\n      } else {\n        followText = `Select all ${users.length} people`;\n      }\n    } else {\n      followText = 'Deselect all';\n    }\n\n    return (\n      <button\n        type=\"button\"\n        class=\"crayons-btn crayons-btn--ghost-brand -ml-2\"\n        onClick={() => this.handleSelectAll()}\n      >\n        {followText}\n      </button>\n    );\n  }\n\n  render() {\n    const { users, selectedUsers } = this.state;\n    const { prev, slidesCount, currentSlideIndex } = this.props;\n    const canSkip = selectedUsers.length === 0;\n\n    return (\n      <div\n        data-testid=\"onboarding-follow-users\"\n        className=\"onboarding-main crayons-modal\"\n      >\n        <div\n          className=\"crayons-modal__box overflow-auto\"\n          role=\"dialog\"\n          aria-labelledby=\"title\"\n          aria-describedby=\"subtitle\"\n        >\n          <Navigation\n            prev={prev}\n            next={this.handleComplete}\n            canSkip={canSkip}\n            slidesCount={slidesCount}\n            currentSlideIndex={currentSlideIndex}\n          />\n          <div className=\"onboarding-content toggle-bottom\">\n            <header className=\"onboarding-content-header\">\n              <h1 id=\"title\" className=\"title\">\n                Suggested people to follow\n              </h1>\n              <h2 id=\"subtitle\" className=\"subtitle\">\n                Let&apos;s review a few things first\n              </h2>\n              <div className=\"onboarding-selection-status\">\n                {this.renderFollowCount()}\n                {this.renderFollowToggle()}\n              </div>\n            </header>\n\n            <div data-testid=\"onboarding-users\">\n              {users.map((user) => (\n                <button\n                  data-testid=\"onboarding-user-button\"\n                  type=\"button\"\n                  onClick={() => this.handleClick(user)}\n                  onKeyDown={() => this.handleKeyDown(user)}\n                  className={\n                    selectedUsers.includes(user)\n                      ? 'user content-row selected'\n                      : 'user content-row unselected'\n                  }\n                >\n                  <figure className=\"user-avatar-container\">\n                    <img\n                      className=\"user-avatar\"\n                      src={user.profile_image_url}\n                      alt=\"profile\"\n                    />\n                  </figure>\n                  <div className=\"user-info\">\n                    <h4 className=\"user-name\">{user.name}</h4>\n                    <p className=\"user-summary\">\n                      {he.unescape(user.summary || '')}\n                    </p>\n                  </div>\n                  <button\n                    data-testid=\"onboarding-user-following-status\"\n                    type=\"button\"\n                    className=\"user-following-status\"\n                  >\n                    {selectedUsers.includes(user) ? 'Following' : 'Follow'}\n                  </button>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nFollowUsers.propTypes = {\n  prev: PropTypes.func.isRequired,\n  next: PropTypes.string.isRequired,\n  slidesCount: PropTypes.number.isRequired,\n  currentSlideIndex: PropTypes.func.isRequired,\n};\n\nexport default FollowUsers;\n"]},"metadata":{},"sourceType":"module"}