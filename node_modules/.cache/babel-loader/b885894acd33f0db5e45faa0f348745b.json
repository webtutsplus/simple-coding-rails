{"ast":null,"code":"/* eslint-disable no-alert */\n\n/* eslint-disable no-restricted-globals */\nfunction toggleTemplateTypeButton(form, e) {\n  var targetType = e.target.dataset.targetType;\n  var activeType = targetType === 'personal' ? 'moderator' : 'personal';\n  e.target.classList.toggle('active');\n  form.getElementsByClassName(\"\".concat(activeType, \"-template-button\"))[0].classList.toggle('active');\n  form.getElementsByClassName(\"\".concat(targetType, \"-responses-container\"))[0].classList.toggle('hidden');\n  form.getElementsByClassName(\"\".concat(activeType, \"-responses-container\"))[0].classList.toggle('hidden');\n}\n\nvar noResponsesHTML = \"\\n<div class=\\\"mod-response-wrapper mod-response-wrapper-empty\\\">\\n  <p>\\uD83E\\uDD14... It looks like you don't have any templates yet.</p>\\n</div>\\n\";\n\nfunction buildHTML(response, typeOf) {\n  if (response.length === 0 && typeOf === 'personal_comment') {\n    return noResponsesHTML;\n  }\n\n  if (typeOf === 'personal_comment') {\n    return response.map(function (obj) {\n      return \"\\n          <div class=\\\"mod-response-wrapper flex mb-4\\\">\\n            <div class=\\\"flex-1\\\">\\n              <h4>\".concat(obj.title, \"</h4>\\n              <p>\").concat(obj.content, \"</p>\\n            </div>\\n            <div class=\\\"pl-2\\\">\\n              <button class=\\\"crayons-btn crayons-btn--secondary crayons-btn--s insert-template-button\\\" type=\\\"button\\\" data-content=\\\"\").concat(obj.content, \"\\\">Insert</button>\\n            </div>\\n          </div>\\n        \");\n    }).join('');\n  }\n\n  if (typeOf === 'mod_comment') {\n    return response.map(function (obj) {\n      return \"\\n            <div class=\\\"mod-response-wrapper mb-4 flex\\\">\\n              <div class=\\\"flex-1\\\">\\n                <h4>\".concat(obj.title, \"</h4>\\n                <p>\").concat(obj.content, \"</p>\\n              </div>\\n              <div class=\\\"flex flex-nowrap pl-2\\\">\\n                <button class=\\\"crayons-btn crayons-btn--s crayons-btn--secondary moderator-submit-button\\\" type=\\\"submit\\\" data-response-template-id=\\\"\").concat(obj.id, \"\\\">Send as Mod</button>\\n                <button class=\\\"crayons-btn crayons-btn--s crayons-btn--outlined insert-template-button\\\" type=\\\"button\\\" data-content=\\\"\").concat(obj.content, \"\\\">Insert</button>\\n              </div>\\n            </div>\\n          \");\n    }).join('');\n  }\n\n  return \"Error \\uD83D\\uDE1E\";\n}\n\nfunction submitAsModerator(responseTemplateId, parentId) {\n  var commentableId = document.getElementById('comment_commentable_id').value;\n  fetch(\"/comments/moderator_create\", {\n    method: 'POST',\n    headers: {\n      Accept: 'application/json',\n      'X-CSRF-Token': window.csrfToken,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      response_template: {\n        id: responseTemplateId\n      },\n      comment: {\n        body_markdown: '',\n        commentable_id: commentableId,\n        commentable_type: 'Article',\n        parent_id: parentId\n      }\n    })\n  }).then(function (response) {\n    return response.json();\n  }).then(function (response) {\n    if (response.status === 'created') {\n      window.location.pathname = response.path;\n    } else if (response.status === 'comment already exists') {\n      alert('This comment already exists.');\n    } else if (response.error === 'error') {\n      alert(\"There was a problem submitting this comment: \".concat(response.status));\n    }\n  });\n}\n\nvar confirmMsg = \"\\nAre you sure you want to submit this comment as Sloan?\\n\\nIt will be sent immediately and users will be notified.\\n\\nMake sure this is the appropriate comment for the situation.\\n\\nThis action is not reversible.\";\n\nfunction addClickListeners(form) {\n  var responsesContainer = form.getElementsByClassName('response-templates-container')[0];\n  var parentCommentId = form.id !== 'new_comment' && !form.id.includes('edit_comment');\n  var insertButtons = Array.from(responsesContainer.getElementsByClassName('insert-template-button'));\n  var moderatorSubmitButtons = Array.from(responsesContainer.getElementsByClassName('moderator-submit-button'));\n  insertButtons.forEach(function (button) {\n    button.addEventListener('click', function (e) {\n      var content = e.target.dataset.content;\n      var textArea = form.getElementsByTagName('textarea')[0];\n      var textAreaReplaceable = textArea.value === null || textArea.value === '' || confirm('Are you sure you want to replace your current comment draft?');\n\n      if (textAreaReplaceable) {\n        textArea.value = content;\n        textArea.focus();\n        responsesContainer.classList.toggle('hidden');\n      }\n    });\n  });\n  moderatorSubmitButtons.forEach(function (button) {\n    button.addEventListener('click', function (e) {\n      e.preventDefault();\n\n      if (confirm(confirmMsg)) {\n        submitAsModerator(e.target.dataset.responseTemplateId, parentCommentId);\n      }\n    });\n  });\n}\n\nfunction fetchResponseTemplates(typeOf, formId) {\n  var form = document.getElementById(formId);\n  var dataContainer;\n\n  if (typeOf === 'personal_comment') {\n    dataContainer = form.getElementsByClassName('personal-responses-container')[0];\n  } else if (typeOf === 'mod_comment') {\n    dataContainer = form.getElementsByClassName('moderator-responses-container')[0];\n  }\n  /* eslint-disable-next-line no-undef */\n\n\n  fetch(\"/response_templates?type_of=\".concat(typeOf), {\n    method: 'GET',\n    headers: {\n      Accept: 'application/json',\n      'X-CSRF-Token': window.csrfToken,\n      'Content-Type': 'application/json'\n    }\n  }).then(function (response) {\n    return response.json();\n  }).then(function (response) {\n    form.querySelector('img.loading-img').classList.toggle('hidden');\n    dataContainer.innerHTML = buildHTML(response, typeOf);\n    var topLevelData = document.getElementById('response-templates-data');\n    topLevelData.innerHTML = dataContainer.parentElement.innerHTML;\n    addClickListeners(form);\n  });\n}\n\nfunction prepareHeaderButtons(form) {\n  var personalTemplateButton = form.getElementsByClassName('personal-template-button')[0];\n  var modTemplateButton = form.getElementsByClassName('moderator-template-button')[0];\n  personalTemplateButton.addEventListener('click', function (e) {\n    toggleTemplateTypeButton(form, e);\n  });\n  modTemplateButton.addEventListener('click', function (e) {\n    toggleTemplateTypeButton(form, e);\n  });\n  modTemplateButton.classList.remove('hidden');\n  modTemplateButton.addEventListener('click', function () {\n    var topLevelData = document.getElementById('response-templates-data');\n    var modDataNotFetched = topLevelData.innerHTML !== '' ? topLevelData.getElementsByClassName('moderator-responses-container')[0].childElementCount === 0 : false;\n\n    if (modDataNotFetched) {\n      form.querySelector('img.loading-img').classList.toggle('hidden');\n      fetchResponseTemplates('mod_comment', form.id);\n    }\n  }, {\n    once: true\n  });\n}\n\nfunction copyData(responsesContainer) {\n  responsesContainer.innerHTML = document.getElementById('response-templates-data').innerHTML;\n}\n\nfunction loadData(form) {\n  form.querySelector('img.loading-img').classList.toggle('hidden');\n  fetchResponseTemplates('personal_comment', form.id);\n}\n\nfunction openButtonCallback(form) {\n  var responsesContainer = form.getElementsByClassName('response-templates-container')[0];\n  var dataFetched = document.getElementById('response-templates-data').innerHTML !== '';\n  responsesContainer.classList.toggle('hidden');\n  var containerHidden = responsesContainer.classList.contains('hidden');\n\n  if (dataFetched && !containerHidden) {\n    copyData(responsesContainer);\n    addClickListeners(form);\n  } else if (!dataFetched && !containerHidden) {\n    loadData(form);\n  }\n  /* eslint-disable-next-line no-undef */\n\n\n  if (userData().moderator_for_tags.length > 0) {\n    prepareHeaderButtons(form);\n  } else {\n    form.getElementsByClassName('personal-template-button')[0].classList.add('hidden');\n  }\n}\n\nfunction prepareOpenButton(form) {\n  var button = form.getElementsByClassName('response-templates-button')[0];\n\n  if (!button) {\n    return;\n  }\n\n  button.addEventListener('click', function () {\n    openButtonCallback(form);\n  });\n  button.dataset.hasListener = 'true';\n}\n\nfunction observeForReplyClick() {\n  var config = {\n    childList: true,\n    subtree: true\n  };\n\n  var callback = function callback(mutations) {\n    var form = Array.from(mutations[0].addedNodes).filter(function (node) {\n      return node.nodeName === 'FORM';\n    });\n\n    if (form.length > 0) {\n      prepareOpenButton(form[0]);\n    }\n  };\n\n  var observer = new MutationObserver(callback);\n  var commentTree = document.getElementById('comment-trees-container');\n\n  if (commentTree) {\n    observer.observe(commentTree, config);\n  }\n\n  window.addEventListener('beforeunload', function () {\n    observer.disconnect();\n  });\n  window.InstantClick.on('change', function () {\n    observer.disconnect();\n  });\n}\n\nfunction handleLoggedOut() {\n  var _document$getElements;\n\n  // global method from app/assets/javascripts/utilities/showModal.js\n  (_document$getElements = document.getElementsByClassName('response-templates-button')[0]) === null || _document$getElements === void 0 ? void 0 : _document$getElements.addEventListener('click', showModal);\n  /* eslint-disable-line no-undef */\n}\n/* eslint-enable no-alert */\n\n/* eslint-enable no-restricted-globals */\n\n\nexport function loadResponseTemplates() {\n  var userStatus = document.body.dataset.userStatus;\n  var form = document.getElementsByClassName('comment-form')[0];\n\n  if (document.getElementById('response-templates-data')) {\n    if (userStatus === 'logged-out') {\n      handleLoggedOut();\n    }\n\n    if (form && form.getElementsByClassName('response-templates-button')[0].dataset.hasListener === 'false') {\n      prepareOpenButton(form);\n    }\n\n    observeForReplyClick();\n  }\n}","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/responseTemplates/responseTemplates.js"],"names":["toggleTemplateTypeButton","form","e","targetType","target","dataset","activeType","classList","toggle","getElementsByClassName","noResponsesHTML","buildHTML","response","typeOf","length","map","obj","title","content","join","id","submitAsModerator","responseTemplateId","parentId","commentableId","document","getElementById","value","fetch","method","headers","Accept","window","csrfToken","body","JSON","stringify","response_template","comment","body_markdown","commentable_id","commentable_type","parent_id","then","json","status","location","pathname","path","alert","error","confirmMsg","addClickListeners","responsesContainer","parentCommentId","includes","insertButtons","Array","from","moderatorSubmitButtons","forEach","button","addEventListener","textArea","getElementsByTagName","textAreaReplaceable","confirm","focus","preventDefault","fetchResponseTemplates","formId","dataContainer","querySelector","innerHTML","topLevelData","parentElement","prepareHeaderButtons","personalTemplateButton","modTemplateButton","remove","modDataNotFetched","childElementCount","once","copyData","loadData","openButtonCallback","dataFetched","containerHidden","contains","userData","moderator_for_tags","add","prepareOpenButton","hasListener","observeForReplyClick","config","childList","subtree","callback","mutations","addedNodes","filter","node","nodeName","observer","MutationObserver","commentTree","observe","disconnect","InstantClick","on","handleLoggedOut","showModal","loadResponseTemplates","userStatus"],"mappings":"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","sourcesContent":["/* eslint-disable no-alert */\n/* eslint-disable no-restricted-globals */\n\nfunction toggleTemplateTypeButton(form, e) {\n  const { targetType } = e.target.dataset;\n  const activeType = targetType === 'personal' ? 'moderator' : 'personal';\n  e.target.classList.toggle('active');\n  form\n    .getElementsByClassName(`${activeType}-template-button`)[0]\n    .classList.toggle('active');\n  form\n    .getElementsByClassName(`${targetType}-responses-container`)[0]\n    .classList.toggle('hidden');\n  form\n    .getElementsByClassName(`${activeType}-responses-container`)[0]\n    .classList.toggle('hidden');\n}\n\nconst noResponsesHTML = `\n<div class=\"mod-response-wrapper mod-response-wrapper-empty\">\n  <p>ðŸ¤”... It looks like you don't have any templates yet.</p>\n</div>\n`;\n\nfunction buildHTML(response, typeOf) {\n  if (response.length === 0 && typeOf === 'personal_comment') {\n    return noResponsesHTML;\n  }\n  if (typeOf === 'personal_comment') {\n    return response\n      .map((obj) => {\n        return `\n          <div class=\"mod-response-wrapper flex mb-4\">\n            <div class=\"flex-1\">\n              <h4>${obj.title}</h4>\n              <p>${obj.content}</p>\n            </div>\n            <div class=\"pl-2\">\n              <button class=\"crayons-btn crayons-btn--secondary crayons-btn--s insert-template-button\" type=\"button\" data-content=\"${obj.content}\">Insert</button>\n            </div>\n          </div>\n        `;\n      })\n      .join('');\n  }\n  if (typeOf === 'mod_comment') {\n    return response\n      .map((obj) => {\n        return `\n            <div class=\"mod-response-wrapper mb-4 flex\">\n              <div class=\"flex-1\">\n                <h4>${obj.title}</h4>\n                <p>${obj.content}</p>\n              </div>\n              <div class=\"flex flex-nowrap pl-2\">\n                <button class=\"crayons-btn crayons-btn--s crayons-btn--secondary moderator-submit-button\" type=\"submit\" data-response-template-id=\"${obj.id}\">Send as Mod</button>\n                <button class=\"crayons-btn crayons-btn--s crayons-btn--outlined insert-template-button\" type=\"button\" data-content=\"${obj.content}\">Insert</button>\n              </div>\n            </div>\n          `;\n      })\n      .join('');\n  }\n  return `Error ðŸ˜ž`;\n}\n\nfunction submitAsModerator(responseTemplateId, parentId) {\n  const commentableId = document.getElementById('comment_commentable_id').value;\n\n  fetch(`/comments/moderator_create`, {\n    method: 'POST',\n    headers: {\n      Accept: 'application/json',\n      'X-CSRF-Token': window.csrfToken,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      response_template: {\n        id: responseTemplateId,\n      },\n      comment: {\n        body_markdown: '',\n        commentable_id: commentableId,\n        commentable_type: 'Article',\n        parent_id: parentId,\n      },\n    }),\n  })\n    .then((response) => response.json())\n    .then((response) => {\n      if (response.status === 'created') {\n        window.location.pathname = response.path;\n      } else if (response.status === 'comment already exists') {\n        alert('This comment already exists.');\n      } else if (response.error === 'error') {\n        alert(\n          `There was a problem submitting this comment: ${response.status}`,\n        );\n      }\n    });\n}\n\nconst confirmMsg = `\nAre you sure you want to submit this comment as Sloan?\n\nIt will be sent immediately and users will be notified.\n\nMake sure this is the appropriate comment for the situation.\n\nThis action is not reversible.`;\n\nfunction addClickListeners(form) {\n  const responsesContainer = form.getElementsByClassName(\n    'response-templates-container',\n  )[0];\n  const parentCommentId =\n    form.id !== 'new_comment' && !form.id.includes('edit_comment');\n  const insertButtons = Array.from(\n    responsesContainer.getElementsByClassName('insert-template-button'),\n  );\n  const moderatorSubmitButtons = Array.from(\n    responsesContainer.getElementsByClassName('moderator-submit-button'),\n  );\n\n  insertButtons.forEach((button) => {\n    button.addEventListener('click', (e) => {\n      const { content } = e.target.dataset;\n      const textArea = form.getElementsByTagName('textarea')[0];\n      const textAreaReplaceable =\n        textArea.value === null ||\n        textArea.value === '' ||\n        confirm('Are you sure you want to replace your current comment draft?');\n\n      if (textAreaReplaceable) {\n        textArea.value = content;\n        textArea.focus();\n        responsesContainer.classList.toggle('hidden');\n      }\n    });\n  });\n\n  moderatorSubmitButtons.forEach((button) => {\n    button.addEventListener('click', (e) => {\n      e.preventDefault();\n\n      if (confirm(confirmMsg)) {\n        submitAsModerator(e.target.dataset.responseTemplateId, parentCommentId);\n      }\n    });\n  });\n}\n\nfunction fetchResponseTemplates(typeOf, formId) {\n  const form = document.getElementById(formId);\n  let dataContainer;\n  if (typeOf === 'personal_comment') {\n    dataContainer = form.getElementsByClassName(\n      'personal-responses-container',\n    )[0];\n  } else if (typeOf === 'mod_comment') {\n    dataContainer = form.getElementsByClassName(\n      'moderator-responses-container',\n    )[0];\n  }\n  /* eslint-disable-next-line no-undef */\n  fetch(`/response_templates?type_of=${typeOf}`, {\n    method: 'GET',\n    headers: {\n      Accept: 'application/json',\n      'X-CSRF-Token': window.csrfToken,\n      'Content-Type': 'application/json',\n    },\n  })\n    .then((response) => response.json())\n    .then((response) => {\n      form.querySelector('img.loading-img').classList.toggle('hidden');\n      dataContainer.innerHTML = buildHTML(response, typeOf);\n      const topLevelData = document.getElementById('response-templates-data');\n      topLevelData.innerHTML = dataContainer.parentElement.innerHTML;\n      addClickListeners(form);\n    });\n}\n\nfunction prepareHeaderButtons(form) {\n  const personalTemplateButton = form.getElementsByClassName(\n    'personal-template-button',\n  )[0];\n  const modTemplateButton = form.getElementsByClassName(\n    'moderator-template-button',\n  )[0];\n\n  personalTemplateButton.addEventListener('click', (e) => {\n    toggleTemplateTypeButton(form, e);\n  });\n  modTemplateButton.addEventListener('click', (e) => {\n    toggleTemplateTypeButton(form, e);\n  });\n  modTemplateButton.classList.remove('hidden');\n\n  modTemplateButton.addEventListener(\n    'click',\n    () => {\n      const topLevelData = document.getElementById('response-templates-data');\n      const modDataNotFetched =\n        topLevelData.innerHTML !== ''\n          ? topLevelData.getElementsByClassName(\n              'moderator-responses-container',\n            )[0].childElementCount === 0\n          : false;\n      if (modDataNotFetched) {\n        form.querySelector('img.loading-img').classList.toggle('hidden');\n        fetchResponseTemplates('mod_comment', form.id);\n      }\n    },\n    { once: true },\n  );\n}\n\nfunction copyData(responsesContainer) {\n  responsesContainer.innerHTML = document.getElementById(\n    'response-templates-data',\n  ).innerHTML;\n}\n\nfunction loadData(form) {\n  form.querySelector('img.loading-img').classList.toggle('hidden');\n  fetchResponseTemplates('personal_comment', form.id);\n}\n\nfunction openButtonCallback(form) {\n  const responsesContainer = form.getElementsByClassName(\n    'response-templates-container',\n  )[0];\n  const dataFetched =\n    document.getElementById('response-templates-data').innerHTML !== '';\n\n  responsesContainer.classList.toggle('hidden');\n\n  const containerHidden = responsesContainer.classList.contains('hidden');\n\n  if (dataFetched && !containerHidden) {\n    copyData(responsesContainer);\n    addClickListeners(form);\n  } else if (!dataFetched && !containerHidden) {\n    loadData(form);\n  }\n  /* eslint-disable-next-line no-undef */\n  if (userData().moderator_for_tags.length > 0) {\n    prepareHeaderButtons(form);\n  } else {\n    form\n      .getElementsByClassName('personal-template-button')[0]\n      .classList.add('hidden');\n  }\n}\n\nfunction prepareOpenButton(form) {\n  const button = form.getElementsByClassName('response-templates-button')[0];\n  if (!button) {\n    return;\n  }\n\n  button.addEventListener('click', () => {\n    openButtonCallback(form);\n  });\n\n  button.dataset.hasListener = 'true';\n}\n\nfunction observeForReplyClick() {\n  const config = { childList: true, subtree: true };\n\n  const callback = (mutations) => {\n    const form = Array.from(mutations[0].addedNodes).filter(\n      (node) => node.nodeName === 'FORM',\n    );\n    if (form.length > 0) {\n      prepareOpenButton(form[0]);\n    }\n  };\n\n  const observer = new MutationObserver(callback);\n\n  const commentTree = document.getElementById('comment-trees-container');\n  if (commentTree) {\n    observer.observe(commentTree, config);\n  }\n\n  window.addEventListener('beforeunload', () => {\n    observer.disconnect();\n  });\n\n  window.InstantClick.on('change', () => {\n    observer.disconnect();\n  });\n}\n\nfunction handleLoggedOut() {\n  // global method from app/assets/javascripts/utilities/showModal.js\n  document\n    .getElementsByClassName('response-templates-button')[0]\n    ?.addEventListener('click', showModal); /* eslint-disable-line no-undef */\n}\n/* eslint-enable no-alert */\n/* eslint-enable no-restricted-globals */\n\nexport function loadResponseTemplates() {\n  const { userStatus } = document.body.dataset;\n\n  const form = document.getElementsByClassName('comment-form')[0];\n\n  if (document.getElementById('response-templates-data')) {\n    if (userStatus === 'logged-out') {\n      handleLoggedOut();\n    }\n    if (\n      form &&\n      form.getElementsByClassName('response-templates-button')[0].dataset\n        .hasListener === 'false'\n    ) {\n      prepareOpenButton(form);\n    }\n    observeForReplyClick();\n  }\n}\n"]},"metadata":{},"sourceType":"module"}