{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { h, Component } from 'preact';\nimport { ListingRow } from './dashboard/listingRow';\nexport var ListingDashboard = /*#__PURE__*/function (_Component) {\n  _inherits(ListingDashboard, _Component);\n\n  var _super = _createSuper(ListingDashboard);\n\n  function ListingDashboard() {\n    var _this;\n\n    _classCallCheck(this, ListingDashboard);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      listings: [],\n      orgListings: [],\n      orgs: [],\n      userCredits: 0,\n      selectedListings: 'user',\n      filter: 'All',\n      sort: 'created_at'\n    });\n\n    return _this;\n  }\n\n  _createClass(ListingDashboard, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var t = this;\n      var container = document.getElementById('listings-dashboard');\n      var listings = [];\n      var orgs = [];\n      var orgListings = [];\n      listings = JSON.parse(container.dataset.listings).sort(function (a, b) {\n        return a.created_at > b.created_at ? -1 : 1;\n      });\n      orgs = JSON.parse(container.dataset.orgs);\n      orgListings = JSON.parse(container.dataset.orglistings);\n      var userCredits = container.dataset.usercredits;\n      t.setState({\n        listings: listings,\n        orgListings: orgListings,\n        orgs: orgs,\n        userCredits: userCredits\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          listings = _this$state.listings,\n          orgListings = _this$state.orgListings,\n          userCredits = _this$state.userCredits,\n          orgs = _this$state.orgs,\n          selectedListings = _this$state.selectedListings,\n          filter = _this$state.filter,\n          sort = _this$state.sort;\n\n      var isExpired = function isExpired(listing) {\n        return listing.bumped_at && !listing.published ? (Date.now() - new Date(listing.bumped_at.toString()).getTime()) / (1000 * 60 * 60 * 24) > 30 : false;\n      };\n\n      var isDraft = function isDraft(listing) {\n        return listing.bumped_at ? !isExpired(listing) && !listing.published : true;\n      };\n\n      var filterListings = function filterListings(listingsToFilter, selectedFilter) {\n        if (selectedFilter === 'Draft') {\n          return listingsToFilter.filter(function (listing) {\n            return isDraft(listing);\n          });\n        }\n\n        if (selectedFilter === 'Expired') {\n          return listingsToFilter.filter(function (listing) {\n            return isExpired(listing);\n          });\n        }\n\n        if (selectedFilter === 'Active') {\n          return listingsToFilter.filter(function (listing) {\n            return listing.published === true;\n          });\n        }\n\n        return listingsToFilter;\n      };\n\n      var customSort = function customSort(a, b) {\n        if (a[sort] === null) {\n          return 1;\n        }\n\n        if (b[sort] === null) {\n          return -1;\n        }\n\n        if (a[sort] > b[sort]) {\n          return -1;\n        }\n\n        return 1;\n      };\n\n      var showListings = function showListings(selected, userListings, organizationListings, selectedFilter) {\n        var displayedListings;\n\n        if (selected === 'user') {\n          displayedListings = filterListings(userListings, selectedFilter).sort(customSort);\n          return displayedListings.map(function (listing) {\n            return h(ListingRow, {\n              listing: listing\n            });\n          });\n        }\n\n        displayedListings = filterListings(organizationListings, selectedFilter).sort(customSort);\n        return displayedListings.map(function (listing) {\n          return listing.organization_id === selected ? h(ListingRow, {\n            listing: listing\n          }) : '';\n        });\n      };\n\n      var setStateOnKeyPress = function setStateOnKeyPress(event, state) {\n        return (event.key === 'Enter' || event.key === ' ') && _this2.setState(state);\n      };\n\n      var filters = ['All', 'Active', 'Draft', 'Expired'];\n      var filterButtons = filters.map(function (f) {\n        return h(\"span\", {\n          onClick: function onClick(event) {\n            _this2.setState({\n              filter: event.target.textContent\n            });\n          },\n          className: \"rounded-btn \".concat(filter === f ? 'active' : ''),\n          role: \"button\",\n          onKeyPress: function onKeyPress(event) {\n            return setStateOnKeyPress(event, {\n              filter: event.target.textContent\n            });\n          },\n          tabIndex: \"0\"\n        }, f);\n      });\n      var sortingDropdown = h(\"div\", {\n        className: \"dashboard-listings-actions\"\n      }, h(\"div\", {\n        className: \"listings-dashboard-filter-buttons\"\n      }, filterButtons), h(\"select\", {\n        \"aria-label\": \"Filter listings\",\n        onChange: function onChange(event) {\n          _this2.setState({\n            sort: event.target.value\n          });\n        },\n        onBlur: function onBlur(event) {\n          _this2.setState({\n            sort: event.target.value\n          });\n        }\n      }, h(\"option\", {\n        value: \"created_at\",\n        selected: \"selected\"\n      }, \"Recently Created\"), h(\"option\", {\n        value: \"bumped_at\"\n      }, \"Recently Bumped\")));\n      var orgButtons = orgs.map(function (org) {\n        return h(\"span\", {\n          onClick: function onClick() {\n            return _this2.setState({\n              selectedListings: org.id\n            });\n          },\n          className: \"rounded-btn \".concat(selectedListings === org.id ? 'active' : ''),\n          role: \"button\",\n          tabIndex: \"0\",\n          onKeyPress: function onKeyPress(event) {\n            return setStateOnKeyPress(event, {\n              selectedListings: org.id\n            });\n          }\n        }, org.name);\n      });\n\n      var listingLength = function listingLength(selected, userListings, organizationListings) {\n        return selected === 'user' ? h(\"h4\", null, \"Listings Made:\", userListings.length) : h(\"h4\", null, \"Listings Made:\", ' ', organizationListings.filter(function (listing) {\n          return listing.organization_id === selected;\n        }).length);\n      };\n\n      var creditCount = function creditCount(selected, userCreds, organizations) {\n        return selected === 'user' ? h(\"h4\", null, \"Credits Available:\", userCreds) : h(\"h4\", null, \"Credits Available:\", ' ', organizations.find(function (org) {\n          return org.id === selected;\n        }).unspent_credits_count);\n      };\n\n      return h(\"div\", {\n        className: \"dashboard-listings-container\"\n      }, h(\"span\", {\n        onClick: function onClick() {\n          return _this2.setState({\n            selectedListings: 'user'\n          });\n        },\n        className: \"rounded-btn \".concat(selectedListings === 'user' ? 'active' : ''),\n        role: \"button\",\n        tabIndex: \"0\",\n        onKeyPress: function onKeyPress(event) {\n          return setStateOnKeyPress(event, {\n            selectedListings: 'user'\n          });\n        }\n      }, \"Personal\"), orgButtons, h(\"div\", {\n        className: \"dashboard-listings-header-wrapper\"\n      }, h(\"div\", {\n        className: \"dashboard-listings-header\"\n      }, h(\"h3\", null, \"Listings\"), listingLength(selectedListings, listings, orgListings), h(\"a\", {\n        href: \"/listings/new\"\n      }, \"Create a Listing\")), h(\"div\", {\n        className: \"dashboard-listings-header\"\n      }, h(\"h3\", null, \"Credits\"), creditCount(selectedListings, userCredits, orgs), h(\"a\", {\n        href: \"/credits/purchase\",\n        \"data-no-instant\": true\n      }, \"Buy Credits\"))), sortingDropdown, h(\"div\", {\n        className: \"dashboard-listings-view\"\n      }, showListings(selectedListings, listings, orgListings, filter)));\n    }\n  }]);\n\n  return ListingDashboard;\n}(Component);","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/listings/listingDashboard.jsx"],"names":["h","Component","ListingRow","ListingDashboard","listings","orgListings","orgs","userCredits","selectedListings","filter","sort","t","container","document","getElementById","JSON","parse","dataset","a","b","created_at","orglistings","usercredits","setState","state","isExpired","listing","bumped_at","published","Date","now","toString","getTime","isDraft","filterListings","listingsToFilter","selectedFilter","customSort","showListings","selected","userListings","organizationListings","displayedListings","map","organization_id","setStateOnKeyPress","event","key","filters","filterButtons","f","target","textContent","sortingDropdown","value","orgButtons","org","id","name","listingLength","length","creditCount","userCreds","organizations","find","unspent_credits_count"],"mappings":"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","sourcesContent":["import { h, Component } from 'preact';\nimport { ListingRow } from './dashboard/listingRow';\n\nexport class ListingDashboard extends Component {\n  state = {\n    listings: [],\n    orgListings: [],\n    orgs: [],\n    userCredits: 0,\n    selectedListings: 'user',\n    filter: 'All',\n    sort: 'created_at',\n  };\n\n  componentDidMount() {\n    const t = this;\n    const container = document.getElementById('listings-dashboard');\n    let listings = [];\n    let orgs = [];\n    let orgListings = [];\n    listings = JSON.parse(container.dataset.listings).sort((a, b) =>\n      a.created_at > b.created_at ? -1 : 1,\n    );\n    orgs = JSON.parse(container.dataset.orgs);\n    orgListings = JSON.parse(container.dataset.orglistings);\n    const userCredits = container.dataset.usercredits;\n    t.setState({ listings, orgListings, orgs, userCredits });\n  }\n\n  render() {\n    const {\n      listings,\n      orgListings,\n      userCredits,\n      orgs,\n      selectedListings,\n      filter,\n      sort,\n    } = this.state;\n\n    const isExpired = (listing) =>\n      listing.bumped_at && !listing.published\n        ? (Date.now() - new Date(listing.bumped_at.toString()).getTime()) /\n            (1000 * 60 * 60 * 24) >\n          30\n        : false;\n    const isDraft = (listing) =>\n      listing.bumped_at ? !isExpired(listing) && !listing.published : true;\n\n    const filterListings = (listingsToFilter, selectedFilter) => {\n      if (selectedFilter === 'Draft') {\n        return listingsToFilter.filter((listing) => isDraft(listing));\n      }\n      if (selectedFilter === 'Expired') {\n        return listingsToFilter.filter((listing) => isExpired(listing));\n      }\n      if (selectedFilter === 'Active') {\n        return listingsToFilter.filter((listing) => listing.published === true);\n      }\n      return listingsToFilter;\n    };\n\n    const customSort = (a, b) => {\n      if (a[sort] === null) {\n        return 1;\n      }\n      if (b[sort] === null) {\n        return -1;\n      }\n      if (a[sort] > b[sort]) {\n        return -1;\n      }\n      return 1;\n    };\n\n    const showListings = (\n      selected,\n      userListings,\n      organizationListings,\n      selectedFilter,\n    ) => {\n      let displayedListings;\n      if (selected === 'user') {\n        displayedListings = filterListings(userListings, selectedFilter).sort(\n          customSort,\n        );\n        return displayedListings.map((listing) => (\n          <ListingRow listing={listing} />\n        ));\n      }\n      displayedListings = filterListings(\n        organizationListings,\n        selectedFilter,\n      ).sort(customSort);\n      return displayedListings.map((listing) =>\n        listing.organization_id === selected ? (\n          <ListingRow listing={listing} />\n        ) : (\n          ''\n        ),\n      );\n    };\n\n    const setStateOnKeyPress = (event, state) =>\n      (event.key === 'Enter' || event.key === ' ') && this.setState(state);\n\n    const filters = ['All', 'Active', 'Draft', 'Expired'];\n    const filterButtons = filters.map((f) => (\n      <span\n        onClick={(event) => {\n          this.setState({ filter: event.target.textContent });\n        }}\n        className={`rounded-btn ${filter === f ? 'active' : ''}`}\n        role=\"button\"\n        onKeyPress={(event) =>\n          setStateOnKeyPress(event, { filter: event.target.textContent })\n        }\n        tabIndex=\"0\"\n      >\n        {f}\n      </span>\n    ));\n\n    const sortingDropdown = (\n      <div className=\"dashboard-listings-actions\">\n        <div className=\"listings-dashboard-filter-buttons\">{filterButtons}</div>\n        <select\n          aria-label=\"Filter listings\"\n          onChange={(event) => {\n            this.setState({ sort: event.target.value });\n          }}\n          onBlur={(event) => {\n            this.setState({ sort: event.target.value });\n          }}\n        >\n          <option value=\"created_at\" selected=\"selected\">\n            Recently Created\n          </option>\n          <option value=\"bumped_at\">Recently Bumped</option>\n        </select>\n      </div>\n    );\n\n    const orgButtons = orgs.map((org) => (\n      <span\n        onClick={() => this.setState({ selectedListings: org.id })}\n        className={`rounded-btn ${selectedListings === org.id ? 'active' : ''}`}\n        role=\"button\"\n        tabIndex=\"0\"\n        onKeyPress={(event) =>\n          setStateOnKeyPress(event, { selectedListings: org.id })\n        }\n      >\n        {org.name}\n      </span>\n    ));\n\n    const listingLength = (selected, userListings, organizationListings) => {\n      return selected === 'user' ? (\n        <h4>\n          Listings Made:\n          {userListings.length}\n        </h4>\n      ) : (\n        <h4>\n          Listings Made:{' '}\n          {\n            organizationListings.filter(\n              (listing) => listing.organization_id === selected,\n            ).length\n          }\n        </h4>\n      );\n    };\n\n    const creditCount = (selected, userCreds, organizations) => {\n      return selected === 'user' ? (\n        <h4>\n          Credits Available:\n          {userCreds}\n        </h4>\n      ) : (\n        <h4>\n          Credits Available:{' '}\n          {\n            organizations.find((org) => org.id === selected)\n              .unspent_credits_count\n          }\n        </h4>\n      );\n    };\n\n    return (\n      <div className=\"dashboard-listings-container\">\n        <span\n          onClick={() => this.setState({ selectedListings: 'user' })}\n          className={`rounded-btn ${\n            selectedListings === 'user' ? 'active' : ''\n          }`}\n          role=\"button\"\n          tabIndex=\"0\"\n          onKeyPress={(event) =>\n            setStateOnKeyPress(event, { selectedListings: 'user' })\n          }\n        >\n          Personal\n        </span>\n        {orgButtons}\n        <div className=\"dashboard-listings-header-wrapper\">\n          <div className=\"dashboard-listings-header\">\n            <h3>Listings</h3>\n            {listingLength(selectedListings, listings, orgListings)}\n            <a href=\"/listings/new\">Create a Listing</a>\n          </div>\n          <div className=\"dashboard-listings-header\">\n            <h3>Credits</h3>\n            {creditCount(selectedListings, userCredits, orgs)}\n            <a href=\"/credits/purchase\" data-no-instant>\n              Buy Credits\n            </a>\n          </div>\n        </div>\n        {sortingDropdown}\n        <div className=\"dashboard-listings-view\">\n          {showListings(selectedListings, listings, orgListings, filter)}\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}