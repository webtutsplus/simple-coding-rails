{"ast":null,"code":"function _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { h, Component } from 'preact';\nimport PropTypes from 'prop-types';\nimport linkState from 'linkstate';\nimport postscribe from 'postscribe';\nimport { KeyboardShortcuts } from '../shared/components/useKeyboardShortcuts';\nimport { submitArticle, previewArticle } from './actions';\n/* global activateRunkitTags */\n\nimport { EditorActions, Form, Header, Help, Preview } from './components';\n/*\n  Although the state fields: id, description, canonicalUrl, series, allSeries and\n  editing are not used in this file, they are important to the\n  editor.\n*/\n\nvar ArticleForm = /*#__PURE__*/function (_Component) {\n  _inherits(ArticleForm, _Component);\n\n  var _super = _createSuper(ArticleForm);\n\n  _createClass(ArticleForm, null, [{\n    key: \"handleGistPreview\",\n    value: function handleGistPreview() {\n      var els = document.getElementsByClassName('ltag_gist-liquid-tag');\n\n      for (var i = 0; i < els.length; i += 1) {\n        postscribe(els[i], els[i].firstElementChild.outerHTML);\n      }\n    }\n  }, {\n    key: \"handleRunkitPreview\",\n    value: function handleRunkitPreview() {\n      activateRunkitTags();\n    } // Scripts inserted via innerHTML won't execute, so we use this handler to\n    // make the Asciinema player work in previews.\n\n  }, {\n    key: \"handleAsciinemaPreview\",\n    value: function handleAsciinemaPreview() {\n      var els = document.getElementsByClassName('ltag_asciinema');\n\n      for (var i = 0; i < els.length; i += 1) {\n        var el = els[i];\n        var script = el.removeChild(el.firstElementChild);\n        postscribe(el, script.outerHTML);\n      }\n    }\n  }]);\n\n  function ArticleForm(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleForm);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"localStoreContent\", function () {\n      var _this$state = _this.state,\n          version = _this$state.version,\n          title = _this$state.title,\n          tagList = _this$state.tagList,\n          mainImage = _this$state.mainImage,\n          bodyMarkdown = _this$state.bodyMarkdown;\n      var updatedAt = new Date();\n      localStorage.setItem(\"editor-\".concat(version, \"-\").concat(_this.url), JSON.stringify({\n        title: title,\n        tagList: tagList,\n        mainImage: mainImage,\n        bodyMarkdown: bodyMarkdown,\n        updatedAt: updatedAt\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"setCommonProps\", function (_ref) {\n      var _ref$previewShowing = _ref.previewShowing,\n          previewShowing = _ref$previewShowing === void 0 ? false : _ref$previewShowing,\n          _ref$helpFor = _ref.helpFor,\n          helpFor = _ref$helpFor === void 0 ? null : _ref$helpFor,\n          _ref$helpPosition = _ref.helpPosition,\n          helpPosition = _ref$helpPosition === void 0 ? null : _ref$helpPosition;\n      return {\n        previewShowing: previewShowing,\n        helpFor: helpFor,\n        helpPosition: helpPosition\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fetchPreview\", function (e) {\n      var _this$state2 = _this.state,\n          previewShowing = _this$state2.previewShowing,\n          bodyMarkdown = _this$state2.bodyMarkdown;\n      e.preventDefault();\n\n      if (previewShowing) {\n        _this.setState(_objectSpread({}, _this.setCommonProps({})));\n      } else {\n        previewArticle(bodyMarkdown, _this.showPreview, _this.failedPreview);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showPreview\", function (response) {\n      if (response.processed_html) {\n        _this.setState(_objectSpread(_objectSpread({}, _this.setCommonProps({\n          previewShowing: true\n        })), {}, {\n          previewResponse: response,\n          errors: null\n        }));\n      } else {\n        _this.setState({\n          errors: response,\n          submitting: false\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOrgIdChange\", function (e) {\n      var organizationId = e.target.selectedOptions[0].value;\n\n      _this.setState({\n        organizationId: organizationId\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"failedPreview\", function (response) {\n      // TODO: console.log should not be part of production code. Remove it!\n      // eslint-disable-next-line no-console\n      console.log(response);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleConfigChange\", function (e) {\n      e.preventDefault();\n      var newState = {};\n      newState[e.target.name] = e.target.value;\n\n      _this.setState(newState);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMainImageUrlChange\", function (payload) {\n      _this.setState({\n        mainImage: payload.links[0]\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"removeLocalStorage\", function () {\n      var version = _this.state.version;\n      localStorage.removeItem(\"editor-\".concat(version, \"-\").concat(_this.url));\n      window.removeEventListener('beforeunload', _this.localStoreContent);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onPublish\", function (e) {\n      e.preventDefault();\n\n      _this.setState({\n        submitting: true,\n        published: true\n      });\n\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          state = _assertThisInitialize.state;\n\n      state.published = true;\n      submitArticle(state, _this.removeLocalStorage, _this.handleArticleError);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSaveDraft\", function (e) {\n      e.preventDefault();\n\n      _this.setState({\n        submitting: true,\n        published: false\n      });\n\n      var _assertThisInitialize2 = _assertThisInitialized(_this),\n          state = _assertThisInitialize2.state;\n\n      state.published = false;\n      submitArticle(state, _this.removeLocalStorage, _this.handleArticleError);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClearChanges\", function (e) {\n      e.preventDefault(); // eslint-disable-next-line no-alert\n\n      var revert = window.confirm('Are you sure you want to revert to the previous save?');\n      if (!revert && navigator.userAgent !== 'DEV-Native-ios') return;\n\n      _this.setState({\n        title: _this.article.title || '',\n        tagList: _this.article.cached_tag_list || '',\n        description: '',\n        // eslint-disable-line react/no-unused-state\n        canonicalUrl: _this.article.canonical_url || '',\n        // eslint-disable-line react/no-unused-state\n        series: _this.article.series || '',\n        // eslint-disable-line react/no-unused-state\n        allSeries: _this.article.all_series || [],\n        // eslint-disable-line react/no-unused-state\n        bodyMarkdown: _this.article.body_markdown || '',\n        published: _this.article.published || false,\n        previewShowing: false,\n        previewResponse: '',\n        submitting: false,\n        editing: _this.article.id !== null,\n        // eslint-disable-line react/no-unused-state\n        mainImage: _this.article.main_image || null,\n        errors: null,\n        edited: false,\n        helpFor: null,\n        helpPosition: 0\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleArticleError\", function (response) {\n      var publishFailed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      window.scrollTo(0, 0);\n      var published = _this.state.published;\n\n      _this.setState({\n        errors: response,\n        submitting: false,\n        // Even if it's an update that failed, published will still be set to true\n        published: published && !publishFailed\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleEdit\", function () {\n      _this.localStoreContent();\n\n      var edited = _this.state.edited;\n      if (edited) return;\n\n      _this.setState({\n        edited: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"switchHelpContext\", function (_ref2) {\n      var target = _ref2.target;\n\n      _this.setState(_objectSpread({}, _this.setCommonProps({\n        helpFor: target.id,\n        helpPosition: target.getBoundingClientRect().y\n      })));\n    });\n\n    var _this$props = _this.props,\n        article = _this$props.article,\n        _version = _this$props.version,\n        siteLogo = _this$props.siteLogo;\n    var organizations = _this.props.organizations;\n    _this.article = JSON.parse(article);\n    organizations = organizations ? JSON.parse(organizations) : null;\n    _this.url = window.location.href;\n    var previousContent = JSON.parse(localStorage.getItem(\"editor-\".concat(_version, \"-\").concat(window.location.href))) || {};\n    var isLocalstorageNewer = new Date(previousContent.updatedAt) > new Date(_this.article.updated_at);\n    var previousContentState = previousContent && isLocalstorageNewer ? {\n      title: previousContent.title || '',\n      tagList: previousContent.tagList || '',\n      mainImage: previousContent.mainImage || null,\n      bodyMarkdown: previousContent.bodyMarkdown || '',\n      edited: true\n    } : {};\n    _this.state = _objectSpread({\n      id: _this.article.id || null,\n      // eslint-disable-line react/no-unused-state\n      title: _this.article.title || '',\n      tagList: _this.article.cached_tag_list || '',\n      description: '',\n      // eslint-disable-line react/no-unused-state\n      canonicalUrl: _this.article.canonical_url || '',\n      // eslint-disable-line react/no-unused-state\n      series: _this.article.series || '',\n      // eslint-disable-line react/no-unused-state\n      allSeries: _this.article.all_series || [],\n      // eslint-disable-line react/no-unused-state\n      bodyMarkdown: _this.article.body_markdown || '',\n      published: _this.article.published || false,\n      previewShowing: false,\n      previewResponse: '',\n      submitting: false,\n      editing: _this.article.id !== null,\n      // eslint-disable-line react/no-unused-state\n      mainImage: _this.article.main_image || null,\n      organizations: organizations,\n      organizationId: _this.article.organization_id,\n      errors: null,\n      edited: false,\n      updatedAt: _this.article.updated_at,\n      version: _version,\n      siteLogo: siteLogo,\n      helpFor: null,\n      helpPosition: null\n    }, previousContentState);\n    return _this;\n  }\n\n  _createClass(ArticleForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener('beforeunload', this.localStoreContent);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener('beforeunload', this.localStoreContent);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var previewResponse = this.state.previewResponse;\n\n      if (previewResponse) {\n        this.constructor.handleGistPreview();\n        this.constructor.handleRunkitPreview();\n        this.constructor.handleAsciinemaPreview();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state3 = this.state,\n          title = _this$state3.title,\n          tagList = _this$state3.tagList,\n          bodyMarkdown = _this$state3.bodyMarkdown,\n          published = _this$state3.published,\n          previewShowing = _this$state3.previewShowing,\n          previewResponse = _this$state3.previewResponse,\n          submitting = _this$state3.submitting,\n          organizations = _this$state3.organizations,\n          organizationId = _this$state3.organizationId,\n          mainImage = _this$state3.mainImage,\n          errors = _this$state3.errors,\n          edited = _this$state3.edited,\n          version = _this$state3.version,\n          helpFor = _this$state3.helpFor,\n          helpPosition = _this$state3.helpPosition,\n          siteLogo = _this$state3.siteLogo;\n      return h(\"form\", {\n        id: \"article-form\",\n        className: \"crayons-article-form\",\n        onSubmit: this.onSubmit,\n        onInput: this.toggleEdit\n      }, h(Header, {\n        onPreview: this.fetchPreview,\n        previewShowing: previewShowing,\n        organizations: organizations,\n        organizationId: organizationId,\n        onToggle: this.handleOrgIdChange,\n        siteLogo: siteLogo\n      }), previewShowing ? h(Preview, {\n        previewResponse: previewResponse,\n        articleState: this.state,\n        errors: errors\n      }) : h(Form, {\n        titleDefaultValue: title,\n        titleOnChange: linkState(this, 'title'),\n        tagsDefaultValue: tagList,\n        tagsOnInput: linkState(this, 'tagList'),\n        bodyDefaultValue: bodyMarkdown,\n        bodyOnChange: linkState(this, 'bodyMarkdown'),\n        bodyHasFocus: false,\n        version: version,\n        mainImage: mainImage,\n        onMainImageUrlChange: this.handleMainImageUrlChange,\n        errors: errors,\n        switchHelpContext: this.switchHelpContext\n      }), h(Help, {\n        previewShowing: previewShowing,\n        helpFor: helpFor,\n        helpPosition: helpPosition,\n        version: version\n      }), h(EditorActions, {\n        published: published,\n        version: version,\n        onPublish: this.onPublish,\n        onSaveDraft: this.onSaveDraft,\n        onClearChanges: this.onClearChanges,\n        edited: edited,\n        passedData: this.state,\n        onConfigChange: this.handleConfigChange,\n        submitting: submitting\n      }), h(KeyboardShortcuts, {\n        shortcuts: {\n          'ctrl+shift+KeyP': this.fetchPreview\n        }\n      }));\n    }\n  }]);\n\n  return ArticleForm;\n}(Component);\n\n_defineProperty(ArticleForm, \"propTypes\", {\n  version: PropTypes.string.isRequired,\n  article: PropTypes.string.isRequired,\n  organizations: PropTypes.string,\n  siteLogo: PropTypes.string.isRequired\n});\n\n_defineProperty(ArticleForm, \"defaultProps\", {\n  organizations: ''\n});\n\nexport { ArticleForm as default };","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/article-form/articleForm.jsx"],"names":["h","Component","PropTypes","linkState","postscribe","KeyboardShortcuts","submitArticle","previewArticle","EditorActions","Form","Header","Help","Preview","ArticleForm","els","document","getElementsByClassName","i","length","firstElementChild","outerHTML","activateRunkitTags","el","script","removeChild","props","state","version","title","tagList","mainImage","bodyMarkdown","updatedAt","Date","localStorage","setItem","url","JSON","stringify","previewShowing","helpFor","helpPosition","e","preventDefault","setState","setCommonProps","showPreview","failedPreview","response","processed_html","previewResponse","errors","submitting","organizationId","target","selectedOptions","value","console","log","newState","name","payload","links","removeItem","window","removeEventListener","localStoreContent","published","removeLocalStorage","handleArticleError","revert","confirm","navigator","userAgent","article","cached_tag_list","description","canonicalUrl","canonical_url","series","allSeries","all_series","body_markdown","editing","id","main_image","edited","publishFailed","scrollTo","getBoundingClientRect","y","siteLogo","organizations","parse","location","href","previousContent","getItem","isLocalstorageNewer","updated_at","previousContentState","organization_id","addEventListener","constructor","handleGistPreview","handleRunkitPreview","handleAsciinemaPreview","onSubmit","toggleEdit","fetchPreview","handleOrgIdChange","handleMainImageUrlChange","switchHelpContext","onPublish","onSaveDraft","onClearChanges","handleConfigChange","string","isRequired"],"mappings":"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","sourcesContent":["import { h, Component } from 'preact';\nimport PropTypes from 'prop-types';\nimport linkState from 'linkstate';\nimport postscribe from 'postscribe';\nimport { KeyboardShortcuts } from '../shared/components/useKeyboardShortcuts';\nimport { submitArticle, previewArticle } from './actions';\n\n/* global activateRunkitTags */\n\nimport { EditorActions, Form, Header, Help, Preview } from './components';\n\n/*\n  Although the state fields: id, description, canonicalUrl, series, allSeries and\n  editing are not used in this file, they are important to the\n  editor.\n*/\nexport default class ArticleForm extends Component {\n  static handleGistPreview() {\n    const els = document.getElementsByClassName('ltag_gist-liquid-tag');\n    for (let i = 0; i < els.length; i += 1) {\n      postscribe(els[i], els[i].firstElementChild.outerHTML);\n    }\n  }\n\n  static handleRunkitPreview() {\n    activateRunkitTags();\n  }\n\n  // Scripts inserted via innerHTML won't execute, so we use this handler to\n  // make the Asciinema player work in previews.\n  static handleAsciinemaPreview() {\n    const els = document.getElementsByClassName('ltag_asciinema');\n    for (let i = 0; i < els.length; i += 1) {\n      const el = els[i];\n      const script = el.removeChild(el.firstElementChild);\n      postscribe(el, script.outerHTML);\n    }\n  }\n\n  static propTypes = {\n    version: PropTypes.string.isRequired,\n    article: PropTypes.string.isRequired,\n    organizations: PropTypes.string,\n    siteLogo: PropTypes.string.isRequired,\n  };\n\n  static defaultProps = {\n    organizations: '',\n  };\n\n  constructor(props) {\n    super(props);\n    const { article, version, siteLogo } = this.props;\n    let { organizations } = this.props;\n    this.article = JSON.parse(article);\n    organizations = organizations ? JSON.parse(organizations) : null;\n    this.url = window.location.href;\n\n    const previousContent =\n      JSON.parse(\n        localStorage.getItem(`editor-${version}-${window.location.href}`),\n      ) || {};\n    const isLocalstorageNewer =\n      new Date(previousContent.updatedAt) > new Date(this.article.updated_at);\n\n    const previousContentState =\n      previousContent && isLocalstorageNewer\n        ? {\n            title: previousContent.title || '',\n            tagList: previousContent.tagList || '',\n            mainImage: previousContent.mainImage || null,\n            bodyMarkdown: previousContent.bodyMarkdown || '',\n            edited: true,\n          }\n        : {};\n\n    this.state = {\n      id: this.article.id || null, // eslint-disable-line react/no-unused-state\n      title: this.article.title || '',\n      tagList: this.article.cached_tag_list || '',\n      description: '', // eslint-disable-line react/no-unused-state\n      canonicalUrl: this.article.canonical_url || '', // eslint-disable-line react/no-unused-state\n      series: this.article.series || '', // eslint-disable-line react/no-unused-state\n      allSeries: this.article.all_series || [], // eslint-disable-line react/no-unused-state\n      bodyMarkdown: this.article.body_markdown || '',\n      published: this.article.published || false,\n      previewShowing: false,\n      previewResponse: '',\n      submitting: false,\n      editing: this.article.id !== null, // eslint-disable-line react/no-unused-state\n      mainImage: this.article.main_image || null,\n      organizations,\n      organizationId: this.article.organization_id,\n      errors: null,\n      edited: false,\n      updatedAt: this.article.updated_at,\n      version,\n      siteLogo,\n      helpFor: null,\n      helpPosition: null,\n      ...previousContentState,\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener('beforeunload', this.localStoreContent);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('beforeunload', this.localStoreContent);\n  }\n\n  componentDidUpdate() {\n    const { previewResponse } = this.state;\n\n    if (previewResponse) {\n      this.constructor.handleGistPreview();\n      this.constructor.handleRunkitPreview();\n      this.constructor.handleAsciinemaPreview();\n    }\n  }\n\n  localStoreContent = () => {\n    const { version, title, tagList, mainImage, bodyMarkdown } = this.state;\n    const updatedAt = new Date();\n    localStorage.setItem(\n      `editor-${version}-${this.url}`,\n      JSON.stringify({\n        title,\n        tagList,\n        mainImage,\n        bodyMarkdown,\n        updatedAt,\n      }),\n    );\n  };\n\n  setCommonProps = ({\n    previewShowing = false,\n    helpFor = null,\n    helpPosition = null,\n  }) => {\n    return {\n      previewShowing,\n      helpFor,\n      helpPosition,\n    };\n  };\n\n  fetchPreview = (e) => {\n    const { previewShowing, bodyMarkdown } = this.state;\n    e.preventDefault();\n    if (previewShowing) {\n      this.setState({\n        ...this.setCommonProps({}),\n      });\n    } else {\n      previewArticle(bodyMarkdown, this.showPreview, this.failedPreview);\n    }\n  };\n\n  showPreview = (response) => {\n    if (response.processed_html) {\n      this.setState({\n        ...this.setCommonProps({ previewShowing: true }),\n        previewResponse: response,\n        errors: null,\n      });\n    } else {\n      this.setState({\n        errors: response,\n        submitting: false,\n      });\n    }\n  };\n\n  handleOrgIdChange = (e) => {\n    const organizationId = e.target.selectedOptions[0].value;\n    this.setState({ organizationId });\n  };\n\n  failedPreview = (response) => {\n    // TODO: console.log should not be part of production code. Remove it!\n    // eslint-disable-next-line no-console\n    console.log(response);\n  };\n\n  handleConfigChange = (e) => {\n    e.preventDefault();\n    const newState = {};\n    newState[e.target.name] = e.target.value;\n    this.setState(newState);\n  };\n\n  handleMainImageUrlChange = (payload) => {\n    this.setState({\n      mainImage: payload.links[0],\n    });\n  };\n\n  removeLocalStorage = () => {\n    const { version } = this.state;\n    localStorage.removeItem(`editor-${version}-${this.url}`);\n    window.removeEventListener('beforeunload', this.localStoreContent);\n  };\n\n  onPublish = (e) => {\n    e.preventDefault();\n    this.setState({ submitting: true, published: true });\n    const { state } = this;\n    state.published = true;\n    submitArticle(state, this.removeLocalStorage, this.handleArticleError);\n  };\n\n  onSaveDraft = (e) => {\n    e.preventDefault();\n    this.setState({ submitting: true, published: false });\n    const { state } = this;\n    state.published = false;\n    submitArticle(state, this.removeLocalStorage, this.handleArticleError);\n  };\n\n  onClearChanges = (e) => {\n    e.preventDefault();\n    // eslint-disable-next-line no-alert\n    const revert = window.confirm(\n      'Are you sure you want to revert to the previous save?',\n    );\n    if (!revert && navigator.userAgent !== 'DEV-Native-ios') return;\n\n    this.setState({\n      title: this.article.title || '',\n      tagList: this.article.cached_tag_list || '',\n      description: '', // eslint-disable-line react/no-unused-state\n      canonicalUrl: this.article.canonical_url || '', // eslint-disable-line react/no-unused-state\n      series: this.article.series || '', // eslint-disable-line react/no-unused-state\n      allSeries: this.article.all_series || [], // eslint-disable-line react/no-unused-state\n      bodyMarkdown: this.article.body_markdown || '',\n      published: this.article.published || false,\n      previewShowing: false,\n      previewResponse: '',\n      submitting: false,\n      editing: this.article.id !== null, // eslint-disable-line react/no-unused-state\n      mainImage: this.article.main_image || null,\n      errors: null,\n      edited: false,\n      helpFor: null,\n      helpPosition: 0,\n    });\n  };\n\n  handleArticleError = (response, publishFailed = false) => {\n    window.scrollTo(0, 0);\n    const { published } = this.state;\n    this.setState({\n      errors: response,\n      submitting: false,\n      // Even if it's an update that failed, published will still be set to true\n      published: published && !publishFailed,\n    });\n  };\n\n  toggleEdit = () => {\n    this.localStoreContent();\n    const { edited } = this.state;\n    if (edited) return;\n    this.setState({\n      edited: true,\n    });\n  };\n\n  switchHelpContext = ({ target }) => {\n    this.setState({\n      ...this.setCommonProps({\n        helpFor: target.id,\n        helpPosition: target.getBoundingClientRect().y,\n      }),\n    });\n  };\n\n  render() {\n    const {\n      title,\n      tagList,\n      bodyMarkdown,\n      published,\n      previewShowing,\n      previewResponse,\n      submitting,\n      organizations,\n      organizationId,\n      mainImage,\n      errors,\n      edited,\n      version,\n      helpFor,\n      helpPosition,\n      siteLogo,\n    } = this.state;\n\n    return (\n      <form\n        id=\"article-form\"\n        className=\"crayons-article-form\"\n        onSubmit={this.onSubmit}\n        onInput={this.toggleEdit}\n      >\n        <Header\n          onPreview={this.fetchPreview}\n          previewShowing={previewShowing}\n          organizations={organizations}\n          organizationId={organizationId}\n          onToggle={this.handleOrgIdChange}\n          siteLogo={siteLogo}\n        />\n\n        {previewShowing ? (\n          <Preview\n            previewResponse={previewResponse}\n            articleState={this.state}\n            errors={errors}\n          />\n        ) : (\n          <Form\n            titleDefaultValue={title}\n            titleOnChange={linkState(this, 'title')}\n            tagsDefaultValue={tagList}\n            tagsOnInput={linkState(this, 'tagList')}\n            bodyDefaultValue={bodyMarkdown}\n            bodyOnChange={linkState(this, 'bodyMarkdown')}\n            bodyHasFocus={false}\n            version={version}\n            mainImage={mainImage}\n            onMainImageUrlChange={this.handleMainImageUrlChange}\n            errors={errors}\n            switchHelpContext={this.switchHelpContext}\n          />\n        )}\n\n        <Help\n          previewShowing={previewShowing}\n          helpFor={helpFor}\n          helpPosition={helpPosition}\n          version={version}\n        />\n\n        <EditorActions\n          published={published}\n          version={version}\n          onPublish={this.onPublish}\n          onSaveDraft={this.onSaveDraft}\n          onClearChanges={this.onClearChanges}\n          edited={edited}\n          passedData={this.state}\n          onConfigChange={this.handleConfigChange}\n          submitting={submitting}\n        />\n\n        <KeyboardShortcuts\n          shortcuts={{\n            'ctrl+shift+KeyP': this.fetchPreview,\n          }}\n        />\n      </form>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}