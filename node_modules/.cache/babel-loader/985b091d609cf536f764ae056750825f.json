{"ast":null,"code":"var _require = require('twilio-video'),\n    createLocalVideoTrack = _require.createLocalVideoTrack,\n    connect = _require.connect;\n\nvar root = document.getElementById('videochat');\nvar remoteMedia = document.getElementById('remote-media');\nvar muteButton = document.getElementById('mute-toggle');\nvar videoToggleButton = document.getElementById('videohide-toggle');\nvar localMediaContainer = document.getElementById('local-media');\nvar roomType = document.getElementById('room-type').dataset.type; //Group\n\nconnect(root.dataset.token, {\n  name: 'room-name',\n  audio: true,\n  type: roomType,\n  video: {\n    width: 800\n  }\n}).then(function (room) {\n  room.participants.forEach(participantConnected);\n  room.on('participantConnected', participantConnected);\n  room.on('participantDisconnected', participantDisconnected);\n  room.once('disconnected', function (_error) {\n    return room.participants.forEach(participantDisconnected);\n  });\n\n  muteButton.onclick = function (e) {\n    e.preventDefault();\n    room.localParticipant.audioTracks.forEach(function (trackPub) {\n      if (muteButton.dataset.muted === 'true') {\n        muteButton.dataset.muted = 'false';\n        muteButton.classList.remove('crayons-btn--danger');\n        muteButton.innerHTML = 'Mute';\n        trackPub.track.enable();\n      } else {\n        muteButton.dataset.muted = 'true';\n        muteButton.classList.add('crayons-btn--danger');\n        muteButton.innerHTML = 'Unmute';\n        trackPub.track.disable();\n      }\n    });\n  };\n\n  videoToggleButton.onclick = function (e) {\n    e.preventDefault();\n    room.localParticipant.videoTracks.forEach(function (trackPub) {\n      if (videoToggleButton.dataset.hidden === 'true') {\n        videoToggleButton.dataset.hidden = 'false';\n        videoToggleButton.classList.remove('crayons-btn--danger');\n        videoToggleButton.innerHTML = 'Hide';\n        localMediaContainer.classList.remove('video-hidden');\n        trackPub.track.enable();\n      } else {\n        videoToggleButton.dataset.hidden = 'true';\n        videoToggleButton.classList.add('crayons-btn--danger');\n        videoToggleButton.innerHTML = 'Unhide';\n        localMediaContainer.classList.add('video-hidden');\n        trackPub.track.disable();\n      }\n    });\n  };\n});\ncreateLocalVideoTrack().then(function (track) {\n  localMediaContainer.appendChild(track.attach());\n  document.getElementById('video-controls').classList.add('showing');\n});\n\nfunction participantConnected(participant) {\n  var numExistingDivs = document.getElementsByClassName('individual-video').length;\n  var div = document.createElement('div');\n  div.id = participant.sid;\n  div.className = \"individual-video\".concat(numExistingDivs > 3 ? ' one-of-many-videos' : '');\n  div.innerHTML = \"<div class=\\\"participant-info\\\">      <div class=\\\"participant-name\\\">\".concat(participant.identity, \"</div>      <div class=\\\"disabled-audio-indicator\\\">audio off</div>      <div class=\\\"disabled-video-indicator\\\">video off</div>    </div>\");\n  participant.on('trackSubscribed', function (track) {\n    return trackSubscribed(div, track);\n  });\n  participant.on('trackUnsubscribed', trackUnsubscribed);\n  participant.on('trackDisabled', function (track) {\n    return trackDisabled(div, track);\n  });\n  participant.on('trackEnabled', function (track) {\n    return trackEnabled(div, track);\n  });\n  participant.tracks.forEach(function (publication) {\n    if (publication.isSubscribed) {\n      trackSubscribed(div, publication.track);\n    }\n  });\n  remoteMedia.appendChild(div);\n}\n\nfunction participantDisconnected(participant) {\n  document.getElementById(participant.sid).remove();\n}\n\nfunction trackSubscribed(div, track) {\n  div.appendChild(track.attach());\n\n  if (!track.isEnabled) {\n    if (track.kind === 'video') {\n      div.classList.add('disabled-video');\n    } else {\n      div.classList.add('disabled-audio');\n    }\n  }\n}\n\nfunction trackUnsubscribed(track) {\n  track.detach().forEach(function (element) {\n    return element.remove();\n  });\n}\n\nfunction trackDisabled(div, track) {\n  if (track.kind === 'video') {\n    div.classList.add('disabled-video');\n  } else {\n    div.classList.add('disabled-audio');\n  }\n}\n\nfunction trackEnabled(div, track) {\n  if (track.kind === 'video') {\n    div.classList.remove('disabled-video');\n  } else {\n    div.classList.remove('disabled-audio');\n  }\n}\n\nif (navigator.userAgent === 'DEV-Native-ios') {\n  root.innerHTML = '<h2 class=\"platform-unavailable-message\">This feature is not yet available on iPhone</h2>';\n}","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/packs/videoChat.jsx"],"names":["require","createLocalVideoTrack","connect","root","document","getElementById","remoteMedia","muteButton","videoToggleButton","localMediaContainer","roomType","dataset","type","token","name","audio","video","width","then","room","participants","forEach","participantConnected","on","participantDisconnected","once","_error","onclick","e","preventDefault","localParticipant","audioTracks","trackPub","muted","classList","remove","innerHTML","track","enable","add","disable","videoTracks","hidden","appendChild","attach","participant","numExistingDivs","getElementsByClassName","length","div","createElement","id","sid","className","identity","trackSubscribed","trackUnsubscribed","trackDisabled","trackEnabled","tracks","publication","isSubscribed","isEnabled","kind","detach","element","navigator","userAgent"],"mappings":"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","sourcesContent":["const { createLocalVideoTrack, connect } = require('twilio-video');\nconst root = document.getElementById('videochat');\nconst remoteMedia = document.getElementById('remote-media');\nconst muteButton = document.getElementById('mute-toggle');\nconst videoToggleButton = document.getElementById('videohide-toggle');\nconst localMediaContainer = document.getElementById('local-media');\nconst roomType = document.getElementById('room-type').dataset.type; //Group\n\nconnect(root.dataset.token, {\n  name: 'room-name',\n  audio: true,\n  type: roomType,\n  video: { width: 800 },\n}).then((room) => {\n  room.participants.forEach(participantConnected);\n  room.on('participantConnected', participantConnected);\n\n  room.on('participantDisconnected', participantDisconnected);\n  room.once('disconnected', (_error) =>\n    room.participants.forEach(participantDisconnected),\n  );\n  muteButton.onclick = function (e) {\n    e.preventDefault();\n    room.localParticipant.audioTracks.forEach(function (trackPub) {\n      if (muteButton.dataset.muted === 'true') {\n        muteButton.dataset.muted = 'false';\n        muteButton.classList.remove('crayons-btn--danger');\n        muteButton.innerHTML = 'Mute';\n        trackPub.track.enable();\n      } else {\n        muteButton.dataset.muted = 'true';\n        muteButton.classList.add('crayons-btn--danger');\n        muteButton.innerHTML = 'Unmute';\n        trackPub.track.disable();\n      }\n    });\n  };\n\n  videoToggleButton.onclick = function (e) {\n    e.preventDefault();\n    room.localParticipant.videoTracks.forEach(function (trackPub) {\n      if (videoToggleButton.dataset.hidden === 'true') {\n        videoToggleButton.dataset.hidden = 'false';\n        videoToggleButton.classList.remove('crayons-btn--danger');\n        videoToggleButton.innerHTML = 'Hide';\n        localMediaContainer.classList.remove('video-hidden');\n        trackPub.track.enable();\n      } else {\n        videoToggleButton.dataset.hidden = 'true';\n        videoToggleButton.classList.add('crayons-btn--danger');\n        videoToggleButton.innerHTML = 'Unhide';\n        localMediaContainer.classList.add('video-hidden');\n        trackPub.track.disable();\n      }\n    });\n  };\n});\n\ncreateLocalVideoTrack().then((track) => {\n  localMediaContainer.appendChild(track.attach());\n  document.getElementById('video-controls').classList.add('showing');\n});\n\nfunction participantConnected(participant) {\n  const numExistingDivs = document.getElementsByClassName('individual-video')\n    .length;\n  const div = document.createElement('div');\n  div.id = participant.sid;\n  div.className = `individual-video${\n    numExistingDivs > 3 ? ' one-of-many-videos' : ''\n  }`;\n  div.innerHTML = `<div class=\"participant-info\">\\\n      <div class=\"participant-name\">${participant.identity}</div>\\\n      <div class=\"disabled-audio-indicator\">audio off</div>\\\n      <div class=\"disabled-video-indicator\">video off</div>\\\n    </div>`;\n\n  participant.on('trackSubscribed', (track) => trackSubscribed(div, track));\n  participant.on('trackUnsubscribed', trackUnsubscribed);\n\n  participant.on('trackDisabled', (track) => trackDisabled(div, track));\n  participant.on('trackEnabled', (track) => trackEnabled(div, track));\n\n  participant.tracks.forEach((publication) => {\n    if (publication.isSubscribed) {\n      trackSubscribed(div, publication.track);\n    }\n  });\n  remoteMedia.appendChild(div);\n}\n\nfunction participantDisconnected(participant) {\n  document.getElementById(participant.sid).remove();\n}\n\nfunction trackSubscribed(div, track) {\n  div.appendChild(track.attach());\n  if (!track.isEnabled) {\n    if (track.kind === 'video') {\n      div.classList.add('disabled-video');\n    } else {\n      div.classList.add('disabled-audio');\n    }\n  }\n}\n\nfunction trackUnsubscribed(track) {\n  track.detach().forEach((element) => element.remove());\n}\n\nfunction trackDisabled(div, track) {\n  if (track.kind === 'video') {\n    div.classList.add('disabled-video');\n  } else {\n    div.classList.add('disabled-audio');\n  }\n}\n\nfunction trackEnabled(div, track) {\n  if (track.kind === 'video') {\n    div.classList.remove('disabled-video');\n  } else {\n    div.classList.remove('disabled-audio');\n  }\n}\n\nif (navigator.userAgent === 'DEV-Native-ios') {\n  root.innerHTML =\n    '<h2 class=\"platform-unavailable-message\">This feature is not yet available on iPhone</h2>';\n}\n"]},"metadata":{},"sourceType":"module"}