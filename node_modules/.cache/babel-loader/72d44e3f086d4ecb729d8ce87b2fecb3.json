{"ast":null,"code":"import { callHistoricalAPI, callReferrersAPI } from './client';\n\nfunction resetActive(activeButton) {\n  var buttons = document.getElementsByClassName('timerange-button');\n\n  for (var i = 0; i < buttons.length; i += 1) {\n    var button = buttons[i];\n    button.classList.remove('selected');\n  }\n\n  activeButton.classList.add('selected');\n}\n\nfunction sumAnalytics(data, key) {\n  return Object.entries(data).reduce(function (sum, day) {\n    return sum + day[1][key].total;\n  }, 0);\n}\n\nfunction cardHTML(stat, header) {\n  return \"\\n    <h4>\".concat(header, \"</h4>\\n    <div class=\\\"featured-stat\\\">\").concat(stat, \"</div>\\n  \");\n}\n\nfunction writeCards(data, timeRangeLabel) {\n  var readers = sumAnalytics(data, 'page_views');\n  var reactions = sumAnalytics(data, 'reactions');\n  var comments = sumAnalytics(data, 'comments');\n  var follows = sumAnalytics(data, 'follows');\n  var reactionCard = document.getElementById('reactions-card');\n  var commentCard = document.getElementById('comments-card');\n  var followerCard = document.getElementById('followers-card');\n  var readerCard = document.getElementById('readers-card');\n  readerCard.innerHTML = cardHTML(readers, \"Readers \".concat(timeRangeLabel));\n  commentCard.innerHTML = cardHTML(comments, \"Comments \".concat(timeRangeLabel));\n  reactionCard.innerHTML = cardHTML(reactions, \"Reactions \".concat(timeRangeLabel));\n  followerCard.innerHTML = cardHTML(follows, \"Followers \".concat(timeRangeLabel));\n}\n\nfunction drawChart(_ref) {\n  var canvas = _ref.canvas,\n      title = _ref.title,\n      labels = _ref.labels,\n      datasets = _ref.datasets;\n  var options = {\n    legend: {\n      position: 'bottom'\n    },\n    responsive: true,\n    title: {\n      display: true,\n      text: title\n    },\n    scales: {\n      yAxes: [{\n        ticks: {\n          suggestedMin: 0,\n          precision: 0\n        }\n      }]\n    }\n  };\n  import('chart.js').then(function (_ref2) {\n    var Chart = _ref2.Chart;\n    // eslint-disable-next-line no-new\n    new Chart(canvas, {\n      type: 'line',\n      data: {\n        labels: labels,\n        datasets: datasets,\n        options: options\n      }\n    });\n  });\n}\n\nfunction drawCharts(data, timeRangeLabel) {\n  var labels = Object.keys(data);\n  var parsedData = Object.entries(data).map(function (date) {\n    return date[1];\n  });\n  var comments = parsedData.map(function (date) {\n    return date.comments.total;\n  });\n  var reactions = parsedData.map(function (date) {\n    return date.reactions.total;\n  });\n  var likes = parsedData.map(function (date) {\n    return date.reactions.like;\n  });\n  var readingList = parsedData.map(function (date) {\n    return date.reactions.readinglist;\n  });\n  var unicorns = parsedData.map(function (date) {\n    return date.reactions.unicorn;\n  });\n  var followers = parsedData.map(function (date) {\n    return date.follows.total;\n  });\n  var readers = parsedData.map(function (date) {\n    return date.page_views.total;\n  });\n  drawChart({\n    canvas: document.getElementById('reactions-chart'),\n    title: \"Reactions \".concat(timeRangeLabel),\n    labels: labels,\n    datasets: [{\n      label: 'Total',\n      data: reactions,\n      fill: false,\n      borderColor: 'rgb(75, 192, 192)',\n      lineTension: 0.1\n    }, {\n      label: 'Likes',\n      data: likes,\n      fill: false,\n      borderColor: 'rgb(229, 100, 100)',\n      lineTension: 0.1\n    }, {\n      label: 'Unicorns',\n      data: unicorns,\n      fill: false,\n      borderColor: 'rgb(157, 57, 233)',\n      lineTension: 0.1\n    }, {\n      label: 'Bookmarks',\n      data: readingList,\n      fill: false,\n      borderColor: 'rgb(10, 133, 255)',\n      lineTension: 0.1\n    }]\n  });\n  drawChart({\n    canvas: document.getElementById('comments-chart'),\n    title: \"Comments \".concat(timeRangeLabel),\n    labels: labels,\n    datasets: [{\n      label: 'Comments',\n      data: comments,\n      fill: false,\n      borderColor: 'rgb(75, 192, 192)',\n      lineTension: 0.1\n    }]\n  });\n  drawChart({\n    canvas: document.getElementById('followers-chart'),\n    title: \"New Followers \".concat(timeRangeLabel),\n    labels: labels,\n    datasets: [{\n      label: 'Followers',\n      data: followers,\n      fill: false,\n      borderColor: 'rgb(10, 133, 255)',\n      lineTension: 0.1\n    }]\n  });\n  drawChart({\n    canvas: document.getElementById('readers-chart'),\n    title: \"Reads \".concat(timeRangeLabel),\n    labels: labels,\n    datasets: [{\n      label: 'Reads',\n      data: readers,\n      fill: false,\n      borderColor: 'rgb(157, 57, 233)',\n      lineTension: 0.1\n    }]\n  });\n}\n\nfunction renderReferrers(data) {\n  var container = document.getElementById('referrers-container');\n  var tableBody = data.domains.filter(function (referrer) {\n    return referrer.domain;\n  }).map(function (referrer) {\n    return \"\\n      <tr>\\n        <td>\".concat(referrer.domain, \"</td>\\n        <td>\").concat(referrer.count, \"</td>\\n      </tr>\\n    \");\n  }); // add referrers with empty domains if present\n\n  var emptyDomainReferrer = data.domains.filter(function (referrer) {\n    return !referrer.domain;\n  })[0];\n\n  if (emptyDomainReferrer) {\n    tableBody.push(\"\\n      <tr>\\n        <td>All other external referrers</td>\\n        <td>\".concat(emptyDomainReferrer.count, \"</td>\\n      </tr>\\n    \"));\n  }\n\n  container.innerHTML = tableBody.join('');\n}\n\nfunction callAnalyticsAPI(date, timeRangeLabel, _ref3) {\n  var organizationId = _ref3.organizationId,\n      articleId = _ref3.articleId;\n  callHistoricalAPI(date, {\n    organizationId: organizationId,\n    articleId: articleId\n  }, function (data) {\n    writeCards(data, timeRangeLabel);\n    drawCharts(data, timeRangeLabel);\n  });\n  callReferrersAPI(date, {\n    organizationId: organizationId,\n    articleId: articleId\n  }, function (data) {\n    renderReferrers(data);\n  });\n}\n\nfunction drawWeekCharts(_ref4) {\n  var organizationId = _ref4.organizationId,\n      articleId = _ref4.articleId;\n  resetActive(document.getElementById('week-button'));\n  var oneWeekAgo = new Date();\n  oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n  callAnalyticsAPI(oneWeekAgo, 'this Week', {\n    organizationId: organizationId,\n    articleId: articleId\n  });\n}\n\nfunction drawMonthCharts(_ref5) {\n  var organizationId = _ref5.organizationId,\n      articleId = _ref5.articleId;\n  resetActive(document.getElementById('month-button'));\n  var oneMonthAgo = new Date();\n  oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\n  callAnalyticsAPI(oneMonthAgo, 'this Month', {\n    organizationId: organizationId,\n    articleId: articleId\n  });\n}\n\nfunction drawInfinityCharts(_ref6) {\n  var organizationId = _ref6.organizationId,\n      articleId = _ref6.articleId;\n  resetActive(document.getElementById('infinity-button')); // April 1st is when the DEV analytics feature went into place\n\n  var beginningOfTime = new Date('2019-4-1');\n  callAnalyticsAPI(beginningOfTime, '', {\n    organizationId: organizationId,\n    articleId: articleId\n  });\n}\n\nexport default function initCharts(_ref7) {\n  var organizationId = _ref7.organizationId,\n      articleId = _ref7.articleId;\n  var weekButton = document.getElementById('week-button');\n  weekButton.addEventListener('click', drawWeekCharts.bind(null, {\n    organizationId: organizationId,\n    articleId: articleId\n  }));\n  var monthButton = document.getElementById('month-button');\n  monthButton.addEventListener('click', drawMonthCharts.bind(null, {\n    organizationId: organizationId,\n    articleId: articleId\n  }));\n  var infinityButton = document.getElementById('infinity-button');\n  infinityButton.addEventListener('click', drawInfinityCharts.bind(null, {\n    organizationId: organizationId,\n    articleId: articleId\n  })); // draw week charts by default\n\n  drawWeekCharts({\n    organizationId: organizationId,\n    articleId: articleId\n  });\n}","map":{"version":3,"sources":["/Users/nmadhab/hobby/forem/app/javascript/analytics/dashboard.js"],"names":["callHistoricalAPI","callReferrersAPI","resetActive","activeButton","buttons","document","getElementsByClassName","i","length","button","classList","remove","add","sumAnalytics","data","key","Object","entries","reduce","sum","day","total","cardHTML","stat","header","writeCards","timeRangeLabel","readers","reactions","comments","follows","reactionCard","getElementById","commentCard","followerCard","readerCard","innerHTML","drawChart","canvas","title","labels","datasets","options","legend","position","responsive","display","text","scales","yAxes","ticks","suggestedMin","precision","then","Chart","type","drawCharts","keys","parsedData","map","date","likes","like","readingList","readinglist","unicorns","unicorn","followers","page_views","label","fill","borderColor","lineTension","renderReferrers","container","tableBody","domains","filter","referrer","domain","count","emptyDomainReferrer","push","join","callAnalyticsAPI","organizationId","articleId","drawWeekCharts","oneWeekAgo","Date","setDate","getDate","drawMonthCharts","oneMonthAgo","setMonth","getMonth","drawInfinityCharts","beginningOfTime","initCharts","weekButton","addEventListener","bind","monthButton","infinityButton"],"mappings":"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","sourcesContent":["import { callHistoricalAPI, callReferrersAPI } from './client';\n\nfunction resetActive(activeButton) {\n  const buttons = document.getElementsByClassName('timerange-button');\n  for (let i = 0; i < buttons.length; i += 1) {\n    const button = buttons[i];\n    button.classList.remove('selected');\n  }\n\n  activeButton.classList.add('selected');\n}\n\nfunction sumAnalytics(data, key) {\n  return Object.entries(data).reduce((sum, day) => sum + day[1][key].total, 0);\n}\n\nfunction cardHTML(stat, header) {\n  return `\n    <h4>${header}</h4>\n    <div class=\"featured-stat\">${stat}</div>\n  `;\n}\n\nfunction writeCards(data, timeRangeLabel) {\n  const readers = sumAnalytics(data, 'page_views');\n  const reactions = sumAnalytics(data, 'reactions');\n  const comments = sumAnalytics(data, 'comments');\n  const follows = sumAnalytics(data, 'follows');\n\n  const reactionCard = document.getElementById('reactions-card');\n  const commentCard = document.getElementById('comments-card');\n  const followerCard = document.getElementById('followers-card');\n  const readerCard = document.getElementById('readers-card');\n\n  readerCard.innerHTML = cardHTML(readers, `Readers ${timeRangeLabel}`);\n  commentCard.innerHTML = cardHTML(comments, `Comments ${timeRangeLabel}`);\n  reactionCard.innerHTML = cardHTML(reactions, `Reactions ${timeRangeLabel}`);\n  followerCard.innerHTML = cardHTML(follows, `Followers ${timeRangeLabel}`);\n}\n\nfunction drawChart({ canvas, title, labels, datasets }) {\n  const options = {\n    legend: {\n      position: 'bottom',\n    },\n    responsive: true,\n    title: {\n      display: true,\n      text: title,\n    },\n    scales: {\n      yAxes: [\n        {\n          ticks: {\n            suggestedMin: 0,\n            precision: 0,\n          },\n        },\n      ],\n    },\n  };\n\n  import('chart.js').then(({ Chart }) => {\n    // eslint-disable-next-line no-new\n    new Chart(canvas, {\n      type: 'line',\n      data: {\n        labels,\n        datasets,\n        options,\n      },\n    });\n  });\n}\n\nfunction drawCharts(data, timeRangeLabel) {\n  const labels = Object.keys(data);\n  const parsedData = Object.entries(data).map((date) => date[1]);\n  const comments = parsedData.map((date) => date.comments.total);\n  const reactions = parsedData.map((date) => date.reactions.total);\n  const likes = parsedData.map((date) => date.reactions.like);\n  const readingList = parsedData.map((date) => date.reactions.readinglist);\n  const unicorns = parsedData.map((date) => date.reactions.unicorn);\n  const followers = parsedData.map((date) => date.follows.total);\n  const readers = parsedData.map((date) => date.page_views.total);\n\n  drawChart({\n    canvas: document.getElementById('reactions-chart'),\n    title: `Reactions ${timeRangeLabel}`,\n    labels,\n    datasets: [\n      {\n        label: 'Total',\n        data: reactions,\n        fill: false,\n        borderColor: 'rgb(75, 192, 192)',\n        lineTension: 0.1,\n      },\n      {\n        label: 'Likes',\n        data: likes,\n        fill: false,\n        borderColor: 'rgb(229, 100, 100)',\n        lineTension: 0.1,\n      },\n      {\n        label: 'Unicorns',\n        data: unicorns,\n        fill: false,\n        borderColor: 'rgb(157, 57, 233)',\n        lineTension: 0.1,\n      },\n      {\n        label: 'Bookmarks',\n        data: readingList,\n        fill: false,\n        borderColor: 'rgb(10, 133, 255)',\n        lineTension: 0.1,\n      },\n    ],\n  });\n\n  drawChart({\n    canvas: document.getElementById('comments-chart'),\n    title: `Comments ${timeRangeLabel}`,\n    labels,\n    datasets: [\n      {\n        label: 'Comments',\n        data: comments,\n        fill: false,\n        borderColor: 'rgb(75, 192, 192)',\n        lineTension: 0.1,\n      },\n    ],\n  });\n\n  drawChart({\n    canvas: document.getElementById('followers-chart'),\n    title: `New Followers ${timeRangeLabel}`,\n    labels,\n    datasets: [\n      {\n        label: 'Followers',\n        data: followers,\n        fill: false,\n        borderColor: 'rgb(10, 133, 255)',\n        lineTension: 0.1,\n      },\n    ],\n  });\n\n  drawChart({\n    canvas: document.getElementById('readers-chart'),\n    title: `Reads ${timeRangeLabel}`,\n    labels,\n    datasets: [\n      {\n        label: 'Reads',\n        data: readers,\n        fill: false,\n        borderColor: 'rgb(157, 57, 233)',\n        lineTension: 0.1,\n      },\n    ],\n  });\n}\n\nfunction renderReferrers(data) {\n  const container = document.getElementById('referrers-container');\n  const tableBody = data.domains\n    .filter((referrer) => referrer.domain)\n    .map((referrer) => {\n      return `\n      <tr>\n        <td>${referrer.domain}</td>\n        <td>${referrer.count}</td>\n      </tr>\n    `;\n    });\n\n  // add referrers with empty domains if present\n  const emptyDomainReferrer = data.domains.filter(\n    (referrer) => !referrer.domain,\n  )[0];\n  if (emptyDomainReferrer) {\n    tableBody.push(`\n      <tr>\n        <td>All other external referrers</td>\n        <td>${emptyDomainReferrer.count}</td>\n      </tr>\n    `);\n  }\n\n  container.innerHTML = tableBody.join('');\n}\n\nfunction callAnalyticsAPI(date, timeRangeLabel, { organizationId, articleId }) {\n  callHistoricalAPI(date, { organizationId, articleId }, (data) => {\n    writeCards(data, timeRangeLabel);\n    drawCharts(data, timeRangeLabel);\n  });\n\n  callReferrersAPI(date, { organizationId, articleId }, (data) => {\n    renderReferrers(data);\n  });\n}\n\nfunction drawWeekCharts({ organizationId, articleId }) {\n  resetActive(document.getElementById('week-button'));\n  const oneWeekAgo = new Date();\n  oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n  callAnalyticsAPI(oneWeekAgo, 'this Week', { organizationId, articleId });\n}\n\nfunction drawMonthCharts({ organizationId, articleId }) {\n  resetActive(document.getElementById('month-button'));\n  const oneMonthAgo = new Date();\n  oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\n  callAnalyticsAPI(oneMonthAgo, 'this Month', { organizationId, articleId });\n}\n\nfunction drawInfinityCharts({ organizationId, articleId }) {\n  resetActive(document.getElementById('infinity-button'));\n  // April 1st is when the DEV analytics feature went into place\n  const beginningOfTime = new Date('2019-4-1');\n  callAnalyticsAPI(beginningOfTime, '', { organizationId, articleId });\n}\n\nexport default function initCharts({ organizationId, articleId }) {\n  const weekButton = document.getElementById('week-button');\n  weekButton.addEventListener(\n    'click',\n    drawWeekCharts.bind(null, { organizationId, articleId }),\n  );\n\n  const monthButton = document.getElementById('month-button');\n  monthButton.addEventListener(\n    'click',\n    drawMonthCharts.bind(null, { organizationId, articleId }),\n  );\n\n  const infinityButton = document.getElementById('infinity-button');\n  infinityButton.addEventListener(\n    'click',\n    drawInfinityCharts.bind(null, { organizationId, articleId }),\n  );\n\n  // draw week charts by default\n  drawWeekCharts({ organizationId, articleId });\n}\n"]},"metadata":{},"sourceType":"module"}